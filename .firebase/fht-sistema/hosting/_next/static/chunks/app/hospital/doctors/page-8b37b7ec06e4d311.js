(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1380],{38265:function(e,r,a){Promise.resolve().then(a.bind(a,88611))},88611:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return k}});var t=a(57437),s=a(2265),i=a(46413),o=a(35153),n=a(13491),c=a(17293),l=a(92651),d=a(16850),u=a(62869),h=a(66070),f=a(95186),m=a(26110),p=a(57054),x=a(23518),v=a(19060),j=a(35974),g=a(26815),y=a(51817),N=a(73247),w=a(55909),b=a(32489),S=a(98335),E=a(37806);let A=e=>{let{onInvitationSuccess:r}=e,{toast:a}=(0,o.pm)(),[i,l]=(0,s.useState)(!1),[d,h]=(0,s.useState)(""),p=async()=>{if(!d){a({title:"Campo Incompleto",description:"O e-mail do m\xe9dico \xe9 obrigat\xf3rio.",variant:"destructive"});return}l(!0);try{let e=(0,n.V1)(c.functions,"sendDoctorInvitation");await e({doctorEmail:d}),a({title:"Sucesso!",description:"Convite enviado para ".concat(d,". O m\xe9dico receber\xe1 um e-mail para se cadastrar."),className:"bg-green-600 text-white"}),r()}catch(e){a({title:"Erro ao Enviar Convite",description:e.message,variant:"destructive"})}finally{l(!1)}};return(0,t.jsxs)(m.cZ,{children:[(0,t.jsxs)(m.fK,{children:[(0,t.jsx)(m.$N,{children:"Convidar Novo M\xe9dico"}),(0,t.jsx)(m.Be,{children:"Insira o e-mail do m\xe9dico para enviar um convite de cadastro. Ap\xf3s o cadastro e aprova\xe7\xe3o, ele ser\xe1 vinculado \xe0 sua unidade."})]}),(0,t.jsx)("div",{className:"grid gap-4 py-4",children:(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(g._,{htmlFor:"email",children:"Email do M\xe9dico"}),(0,t.jsx)(f.I,{id:"email",type:"email",value:d,onChange:e=>h(e.target.value),placeholder:"email@exemplo.com"})]})}),(0,t.jsx)(m.cN,{children:(0,t.jsxs)(u.z,{onClick:p,disabled:i,children:[i&&(0,t.jsx)(y.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviar Convite"]})})]})},C=e=>{var r;let{onAssociationSuccess:a}=e,{toast:l}=(0,o.pm)(),[h,g]=(0,s.useState)(""),[E,A]=(0,s.useState)([]),[C,k]=(0,s.useState)([]),[P,R]=(0,s.useState)([]),[I,Z]=(0,s.useState)(!1),[V,T]=(0,s.useState)(null),O=(0,d.N)(h,500),z=null===(r=(0,i.a)().user)||void 0===r?void 0:r.uid;(0,s.useEffect)(()=>{(async()=>{if(z)try{let e=(0,n.V1)(c.functions,"searchAssociatedDoctors"),r=(await e({searchTerm:"",specialtiesFilter:[]})).data.doctors.flatMap(e=>e.specialties||[]),a=Array.from(new Set(r)).sort();k(a)}catch(e){console.error("Erro ao buscar especialidades:",e)}})()},[z]),(0,s.useEffect)(()=>{(async()=>{if(O.length<3&&0===E.length){R([]);return}Z(!0);try{let e=(0,n.V1)(c.functions,"searchAssociatedDoctors"),r=await e({searchTerm:O,specialtiesFilter:E});R(r.data.doctors)}catch(e){l({title:"Erro na Busca",description:e.message,variant:"destructive"}),R([])}finally{Z(!1)}})()},[O,E,l]);let U=async e=>{T(e);try{let r=(0,n.V1)(c.functions,"associateDoctorToUnit");await r({doctorId:e}),l({title:"Sucesso!",description:"M\xe9dico associado \xe0 sua unidade.",className:"bg-green-600 text-white"}),a()}catch(e){l({title:"Erro ao Associar",description:e.message,variant:"destructive"})}finally{T(null)}};return(0,t.jsxs)(m.cZ,{className:"sm:max-w-2xl",children:[(0,t.jsxs)(m.fK,{children:[(0,t.jsx)(m.$N,{children:"Buscar M\xe9dico Vinculado"}),(0,t.jsx)(m.Be,{children:"Procure por um m\xe9dico que j\xe1 tenha v\xednculo com a sua unidade."})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 py-4",children:[(0,t.jsxs)("div",{className:"relative flex-grow",children:[(0,t.jsx)(N.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)(f.I,{placeholder:"Digite nome, CRM ou email",value:h,onChange:e=>g(e.target.value),className:"pl-9"})]}),(0,t.jsxs)(p.J2,{children:[(0,t.jsx)(p.xo,{asChild:!0,children:(0,t.jsxs)(u.z,{variant:"outline",className:"shrink-0",children:[(0,t.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Filtrar (",E.length,")"]})}),(0,t.jsx)(p.yk,{className:"w-64 p-0",children:(0,t.jsxs)(x.mY,{children:[(0,t.jsx)(x.sZ,{placeholder:"Buscar especialidade..."}),(0,t.jsx)(x.rb,{children:"Nenhuma especialidade encontrada."}),(0,t.jsx)(x.fu,{children:C.map(e=>(0,t.jsxs)(x.di,{onSelect:()=>{A(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},children:[(0,t.jsx)(v.X,{className:"mr-2",checked:E.includes(e)}),(0,t.jsx)("span",{children:e})]},e))})]})})]})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 items-center mb-2",children:E.map(e=>(0,t.jsxs)(j.C,{variant:"secondary",children:[e,(0,t.jsx)("button",{onClick:()=>A(r=>r.filter(r=>r!==e)),className:"ml-1",children:(0,t.jsx)(b.Z,{className:"h-3 w-3"})})]},e))}),(0,t.jsxs)("div",{className:"mt-4 max-h-64 overflow-y-auto space-y-2",children:[I&&(0,t.jsx)("div",{className:"flex justify-center p-4",children:(0,t.jsx)(y.Z,{className:"h-6 w-6 animate-spin"})}),!I&&P.length>0&&P.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["CRM: ",e.crm||"N\xe3o informado"]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.specialties.map(e=>(0,t.jsx)(j.C,{variant:"outline",children:e},e))})]}),(0,t.jsxs)(u.z,{size:"sm",onClick:()=>U(e.uid),disabled:V===e.uid,children:[V===e.uid?(0,t.jsx)(y.Z,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(S.Z,{className:"mr-2 h-4 w-4"}),"Associar"]})]},e.uid)),!I&&(O.length>=3||E.length>0)&&0===P.length&&(0,t.jsx)("p",{className:"text-center text-sm text-muted-foreground py-4",children:"Nenhum resultado encontrado para os filtros aplicados."})]})]})};function k(){let{user:e}=(0,i.a)(),[r,a]=(0,s.useState)([]),[o,n]=(0,s.useState)(!0),[c,d]=(0,s.useState)(!1),[f,p]=(0,s.useState)(!1),x=(0,s.useCallback)(async()=>{if(e){n(!0);try{let r=await (0,l.l5)(e.uid);a(r.filter(e=>"doctor"===e.userType))}catch(e){console.error("Erro ao buscar m\xe9dicos associados:",e)}finally{n(!1)}}},[e]);return(0,s.useEffect)(()=>{x()},[x]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Gest\xe3o de M\xe9dicos"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(m.Vq,{open:c,onOpenChange:d,children:[(0,t.jsx)(m.hg,{asChild:!0,children:(0,t.jsxs)(u.z,{variant:"outline",children:[(0,t.jsx)(N.Z,{className:"mr-2 h-4 w-4"})," Buscar M\xe9dico"]})}),(0,t.jsx)(C,{onAssociationSuccess:()=>{d(!1),x()}})]}),(0,t.jsxs)(m.Vq,{open:f,onOpenChange:p,children:[(0,t.jsx)(m.hg,{asChild:!0,children:(0,t.jsxs)(u.z,{children:[(0,t.jsx)(E.Z,{className:"mr-2 h-4 w-4"})," Convidar Novo M\xe9dico"]})}),(0,t.jsx)(A,{onInvitationSuccess:()=>{p(!1)}})]})]})]}),(0,t.jsxs)(h.Zb,{children:[(0,t.jsxs)(h.Ol,{children:[(0,t.jsx)(h.ll,{children:"M\xe9dicos Associados \xe0 Unidade"}),(0,t.jsx)(h.SZ,{children:"Esta \xe9 a lista de m\xe9dicos que j\xe1 t\xeam v\xednculo com a sua unidade e foram aprovados."})]}),(0,t.jsx)(h.aY,{children:o?(0,t.jsx)("div",{className:"flex justify-center p-8",children:(0,t.jsx)(y.Z,{className:"h-8 w-8 animate-spin"})}):r.length>0?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(e=>{var r;return(0,t.jsxs)(h.Zb,{children:[(0,t.jsxs)(h.Ol,{children:[(0,t.jsx)(h.ll,{children:e.displayName}),(0,t.jsx)(h.SZ,{children:e.professionalCrm||"CRM n\xe3o informado"})]}),(0,t.jsx)(h.aY,{children:(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:null===(r=e.specialties)||void 0===r?void 0:r.map(e=>(0,t.jsx)(j.C,{variant:"secondary",children:e},e))})})]},e.uid)})}):(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nenhum m\xe9dico associado a esta unidade."})})})]})]})}},46413:function(e,r,a){"use strict";a.d(r,{AuthProvider:function(){return l},a:function(){return d}});var t=a(57437),s=a(2265),i=a(43301),o=a(17293),n=a(92651);let c=(0,s.createContext)(void 0),l=e=>{let{children:r}=e,[a,l]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[h,f]=(0,s.useState)(!0),[m,p]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{console.log("[AuthProvider] Subscribing to onAuthStateChanged (montagem do provider)");let e=(0,i.Aj)(o.auth,async e=>{if(console.log("[AuthProvider] onAuthStateChanged: User state changed. New Firebase user:",e?e.uid:null),l(e),e){p(!0);try{let e=await (0,n.Ts)();u(e),console.log("[AuthProvider] onAuthStateChanged: Profile fetched after user state change:",e)}catch(e){console.error("[AuthProvider] onAuthStateChanged: Error fetching profile:",e),u(null)}finally{p(!1)}}else u(null),p(!1);f(!1),console.log("[AuthProvider] onAuthStateChanged: Loading set to false.")});return()=>{console.log("[AuthProvider] Unsubscribing from onAuthStateChanged (desmontagem do provider)"),e()}},[]),console.log("[AuthProvider] Context values updated - User:",a?a.uid:null,"Loading:",h,"ProfileLoading:",m),(0,t.jsx)(c.Provider,{value:{user:a,userProfile:d,loading:h,profileLoading:m},children:r})},d=()=>{let e=(0,s.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},66070:function(e,r,a){"use strict";a.d(r,{Ol:function(){return n},SZ:function(){return l},Zb:function(){return o},aY:function(){return d},eW:function(){return u},ll:function(){return c}});var t=a(57437),s=a(2265),i=a(94508);let o=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});o.displayName="Card";let n=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",a),...s})});n.displayName="CardHeader";let c=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});c.displayName="CardTitle";let l=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})});l.displayName="CardDescription";let d=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",a),...s})});d.displayName="CardContent";let u=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",a),...s})});u.displayName="CardFooter"},19060:function(e,r,a){"use strict";a.d(r,{X:function(){return c}});var t=a(57437),s=a(2265),i=a(9270),o=a(30401),n=a(94508);let c=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)(i.fC,{ref:r,className:(0,n.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...s,children:(0,t.jsx)(i.z$,{className:(0,n.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(o.Z,{className:"h-4 w-4"})})})});c.displayName=i.fC.displayName},16850:function(e,r,a){"use strict";a.d(r,{N:function(){return s}});var t=a(2265);function s(e,r){let[a,s]=(0,t.useState)(e);return(0,t.useEffect)(()=>{let a=setTimeout(()=>{s(e)},r);return()=>{clearTimeout(a)}},[e,r]),a}},92651:function(e,r,a){"use strict";a.d(r,{CQ:function(){return d},Fl:function(){return x},TX:function(){return h},Ts:function(){return m},XB:function(){return n},bI:function(){return p},c0:function(){return f},hc:function(){return v},l5:function(){return c},pH:function(){return u},q9:function(){return l}});var t=a(43301),s=a(5978),i=a(17293);let o=(0,a(13491).V1)(i.functions,"createStaffUser"),n=async e=>{try{let r=await o(e);if(!r.data.success)throw Error("A fun\xe7\xe3o de backend n\xe3o retornou sucesso.");return r.data.user}catch(e){throw console.error("[AuthService] Erro ao chamar a fun\xe7\xe3o createStaffUser:",e),Error(e.message||"N\xe3o foi poss\xedvel adicionar o membro \xe0 Equipa.")}},c=async e=>{try{let r=(0,s.hJ)(i.db,"users"),a=(0,s.IO)(r,(0,s.ar)("hospitalId","==",e)),t=await (0,s.PL)(a);if(t.empty)return[];return t.docs.map(e=>({uid:e.id,...e.data()})).filter(r=>r.uid!==e)}catch(r){throw console.error("[AuthService] Erro ao buscar a Equipa para o hospital ".concat(e,":"),r),Error("N\xe3o foi poss\xedvel carregar a lista da Equipa.")}},l=async(e,r,a)=>{try{let s=await (0,t.Xb)(i.auth,e,r);return await (0,t.ck)(s.user,{displayName:a}),s.user}catch(e){throw console.error("[AuthService] Erro ao criar usu\xe1rio no Auth:",e),e}},d=async(e,r,a,t,o)=>{let n={};if("doctor"===t){let{documents:e,specialistDocuments:r,invitationToken:a,...t}=o;n={...t,documents:e,specialistDocuments:r,documentVerificationStatus:"PENDING_REVIEW",adminVerificationNotes:"",invitationToken:a||null}}else if("hospital"===t){let{hospitalDocs:e,legalRepDocuments:r,...a}=o;n={companyInfo:{cnpj:a.cnpj,stateRegistration:a.stateRegistration,phone:a.phone,address:a.address},legalRepresentativeInfo:a.legalRepresentativeInfo,hospitalDocs:e,legalRepDocuments:r,documentVerificationStatus:"PENDING_REVIEW",adminVerificationNotes:""}}else if(["receptionist","triage_nurse","caravan_admin","admin","backoffice"].includes(t))n={};else throw Error("Tipo de perfil de registro inv\xe1lido.");let c={uid:e,email:r,displayName:a,userType:t,createdAt:(0,s.Bt)(),updatedAt:(0,s.Bt)(),...n};await (0,s.pl)((0,s.JU)(i.db,"users",e),c),console.log("[AuthService] Perfil ".concat(t," salvo para UID: ").concat(e))},u=async(e,r)=>{try{return(await (0,t.e5)(i.auth,e,r)).user}catch(e){throw console.error("[AuthService] Login error:",e),e}},h=async()=>{try{await (0,t.w7)(i.auth)}catch(e){throw console.error("[AuthService] Logout error:",e),e}},f=async e=>{try{await (0,t.LS)(i.auth,e)}catch(e){throw console.error("[AuthService] Reset error:",e),e}},m=async()=>{let e=i.auth.currentUser;if(!e)return null;try{let r=(0,s.JU)(i.db,"users",e.uid),a=await (0,s.QT)(r);if(a.exists())return{uid:a.id,...a.data()};return null}catch(e){throw console.error("[AuthService] Get current user data error:",e),e}},p=async(e,r)=>{if(!e)throw Error("ID do Doutor n\xe3o fornecido para atualiza\xe7\xe3o.");if(!r||0===Object.keys(r).length){console.warn("[AuthService] Nenhum dado fornecido para atualiza\xe7\xe3o do perfil do doutor.");return}let a=(0,s.JU)(i.db,"users",e),t={};if(Object.keys(r).forEach(e=>{void 0!==r[e]&&("address"===e&&"object"==typeof r.address&&null!==r.address?Object.keys(r.address).forEach(e=>{void 0!==r.address[e]&&(t["address.".concat(e)]=r.address[e])}):t[e]=r[e])}),0===Object.keys(t).length){console.warn("[AuthService] Nenhum dado v\xe1lido para atualizar ap\xf3s filtrar undefined.");return}t.updatedAt=(0,s.Bt)();try{var o;let r=await (0,s.QT)(a);if(!r.exists()||(null===(o=r.data())||void 0===o?void 0:o.userType)!=="doctor")throw Error("Perfil de doutor n\xe3o encontrado ou tipo de usu\xe1rio incorreto para atualiza\xe7\xe3o.");await (0,s.r7)(a,t),console.log("[AuthService] Perfil do doutor ".concat(e," atualizado com sucesso."))}catch(r){throw console.error("[AuthService] Erro ao atualizar perfil do doutor ".concat(e,":"),r),r}},x=async(e,r)=>{try{let a=(0,s.hJ)(i.db,"users"),t=(0,s.IO)(a,(0,s.ar)("userType","==","doctor"),(0,s.ar)("specialties","array-contains",r),(0,s.ar)("healthUnitIds","array-contains",e)),o=await (0,s.PL)(t);if(o.empty)return[];return o.docs.map(e=>({uid:e.id,...e.data()}))}catch(e){throw console.error("[AuthService] Erro ao buscar m\xe9dicos associados por especialidade:",e),Error("N\xe3o foi poss\xedvel carregar a lista de m\xe9dicos para esta unidade.")}},v=async function(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw Error("ID do usu\xe1rio n\xe3o fornecido.");let o=(0,s.JU)(i.db,"users",e),n={documentVerificationStatus:r,adminVerificationNotes:a,documentRejectionReasons:t,updatedAt:(0,s.Bt)()};"APPROVED"===r&&(n.documentRejectionReasons={},n.adminVerificationNotes="");try{await (0,s.r7)(o,n)}catch(r){throw console.error("Erro ao atualizar status do usu\xe1rio ".concat(e,":"),r),Error("Falha ao atualizar o status do cadastro.")}}}},function(e){e.O(0,[4358,9990,6137,9084,9733,6838,6008,2592,4929,1120,2971,2117,1744],function(){return e(e.s=38265)}),_N_E=e.O()}]);