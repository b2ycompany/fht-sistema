(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5328],{85938:function(e,a,s){Promise.resolve().then(s.bind(s,46616))},46616:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return B}});var t=s(57437),r=s(2265),i=s(62869),l=s(35153),n=s(26110),c=s(99397),o=s(18930),d=s(33569),m=s(35974),u=s(94508),h=s(49505),p=s(88501),x=s(83774),f=s(5005),g=s(95252),j=s(33245);let v=Object.entries(h.ku).map(e=>{let[a,s]=e;return{value:a,label:a.split("_").map(e=>e[0].toUpperCase()+e.slice(1)).join(" ")}}),N=e=>{var a;let{shift:s,actions:r}=e,l=(null===(a=v.find(e=>e.value===s.serviceType))||void 0===a?void 0:a.label)||s.serviceType;return(0,t.jsxs)("div",{className:(0,u.cn)("flex flex-col sm:flex-row items-start sm:items-center justify-between border rounded-lg p-4 gap-3 transition-opacity duration-300 bg-white shadow-xs hover:shadow-sm"),children:[(0,t.jsxs)("div",{className:"flex-1 space-y-1.5 pr-2",children:[s.status&&"open"!==s.status&&(0,t.jsx)(m.C,{variant:"filled"===s.status?"secondary":"destructive",className:"text-xs mb-1 capitalize",children:s.status}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-800",children:[" ",(0,t.jsx)(p.Z,{className:"h-4 w-4 shrink-0 text-blue-600"})," ",(0,t.jsx)("span",{suppressHydrationWarning:!0,children:s.date?s.date.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"}):"Inv\xe1lida"})," ",(0,t.jsxs)("span",{className:"text-gray-500 font-normal",children:["(",s.startTime," - ",s.endTime,")"]})," "]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-600",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 ",children:[(0,t.jsx)(x.Z,{className:"h-3.5 w-3.5 shrink-0 text-purple-600"}),(0,t.jsxs)("span",{children:[s.city,", ",s.state]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 ",children:[(0,t.jsx)(f.Z,{className:"h-3.5 w-3.5 shrink-0 text-cyan-600"}),(0,t.jsx)("span",{children:l})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-green-700 font-medium col-span-2",children:[(0,t.jsx)(g.Z,{className:"h-3.5 w-3.5 shrink-0"}),(0,t.jsxs)("span",{children:[(0,u.xG)(s.offeredRate),"/hora"]})]})]}),s.specialtiesRequired&&s.specialtiesRequired.length>0&&(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1 pt-1.5",children:[" ",(0,t.jsx)("span",{className:"text-xs text-gray-500 mr-1 font-medium",children:"Requer:"})," ",s.specialtiesRequired.map(e=>(0,t.jsx)(m.C,{variant:"outline",className:"text-gray-700 text-xs px-1.5 py-0.5 font-normal border-blue-200 bg-blue-50",children:e},e))," "]}),s.notes&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 pt-1.5 italic",children:[(0,t.jsx)(j.Z,{className:"inline h-3 w-3 mr-1 align-middle"}),s.notes]})]}),r&&r.length>0&&(0,t.jsx)("div",{className:"flex items-center space-x-1 shrink-0 mt-2 sm:mt-0 self-end sm:self-center",children:r.map(e=>{var a;return(0,t.jsxs)(i.z,{variant:null!==(a=e.variant)&&void 0!==a?a:"ghost",size:"icon",onClick:e.onClick,className:(0,u.cn)("h-8 w-8",e.className),"aria-label":e.label,children:[" ",(0,t.jsx)(e.icon,{className:"h-4 w-4"})," "]},e.label)})})]})};var y=s(1098),b=s(53647),E=s(26815),w=s(95186),C=s(76818),S=s(57054),R=s(23518),I=s(43044),P=s(32489),k=s(51817);let V=Array.from({length:48},(e,a)=>"".concat(Math.floor(a/2).toString().padStart(2,"0"),":").concat(a%2==0?"00":"30")),A=["SP","RJ","MG","BA","AC","AL","AP","AM","CE","DF","ES","GO","MA","MT","MS","PA","PB","PR","PE","PI","RN","RS","RO","RR","SC","SE","TO"],O={SP:["S\xe3o Paulo","Campinas","Santos","Ara\xe7ariguama","Guarulhos","Osasco"],RJ:["Rio de Janeiro","Niter\xf3i"]},T=Object.entries(h.ku).map(e=>{let[a,s]=e;return{value:a,label:a.split("_").map(e=>e[0].toUpperCase()+e.slice(1)).join(" ")}}),D=e=>{let{onShiftAdded:a}=e,{toast:s}=(0,l.pm)(),[c,o]=(0,r.useState)([]),[p,x]=(0,r.useState)("07:00"),[f,g]=(0,r.useState)("19:00"),[j,v]=(0,r.useState)(!1),[N,D]=(0,r.useState)(!1),[_,B]=(0,r.useState)([]),[U,q]=(0,r.useState)(""),[J,L]=(0,r.useState)(null),[M,z]=(0,r.useState)(""),[F,Z]=(0,r.useState)(""),[G,H]=(0,r.useState)([]),[X,Q]=(0,r.useState)(""),[W,Y]=(0,r.useState)(""),[$,K]=(0,r.useState)(""),ee=(0,r.useCallback)((e,a)=>{if(e&&a&&e===a)L("Hor\xe1rios de in\xedcio e t\xe9rmino n\xe3o podem ser iguais.");else if(e&&a&&e>a){let s=parseInt(e.split(":")[0],10);parseInt(a.split(":")[0],10)>=s?L("In\xedcio deve ser anterior ao t\xe9rmino para hor\xe1rios no mesmo dia."):L(null)}else L(null)},[]);(0,r.useEffect)(()=>{ee(p,f)},[p,f,ee]),(0,r.useEffect)(()=>{M?H(O[M]||[]):H([]),Z("")},[M]);let ea=e=>{_.includes(e)||B([..._,e]),q(""),D(!1)},es=e=>{B(a=>a.filter(a=>a!==e))},et=(0,r.useMemo)(()=>h.Gg.filter(e=>"string"==typeof e&&e.toLowerCase().includes(U.toLowerCase())&&!_.includes(e)),[U,_]),er=async()=>{let e=parseFloat(W.replace(",","."));if(0===c.length){s({title:"Selecione data(s)",variant:"destructive"});return}if(J){s({title:"Hor\xe1rio inv\xe1lido",description:J,variant:"destructive"});return}if(!X){s({title:"Selecione tipo",variant:"destructive"});return}if(isNaN(e)||e<=0){s({title:"Valor hora inv\xe1lido (>0)",variant:"destructive"});return}if(!M||!F){s({title:"Selecione local",variant:"destructive"});return}v(!0);let t=0,r=0,i=c.map(async a=>{try{await (0,d.xf)({date:a,startTime:p,endTime:f,specialtiesRequired:_,serviceType:X,offeredRate:e,city:F,state:M,notes:$}),t++}catch(e){r++,console.error("Failed add shift ".concat(a.toLocaleDateString(),":"),e),s({title:"Erro ao Salvar Data ".concat(a.toLocaleDateString()),description:e.message||"Erro desconhecido",variant:"destructive"})}});await Promise.all(i),v(!1),t>0&&(s({title:"Opera\xe7\xe3o Conclu\xedda",description:"".concat(t," vaga(s) publicada(s). ").concat(r>0?"".concat(r," falharam."):""),variant:"default"}),a())};return(0,t.jsxs)(n.cZ,{className:"sm:max-w-2xl",children:[(0,t.jsxs)(n.fK,{children:[(0,t.jsx)(n.$N,{children:"Publicar Nova Vaga de Plant\xe3o"}),(0,t.jsx)(n.Be,{children:"Preencha os detalhes da vaga. Selecione m\xfaltiplos dias no calend\xe1rio para criar vagas id\xeanticas para cada dia."})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4 max-h-[70vh] overflow-y-auto px-2 pr-5",children:[" ",(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(E._,{className:"font-medium text-gray-800",children:"Data(s)*"}),(0,t.jsx)(y.f,{mode:"multiple",selected:c,onSelect:e=>o(e||[]),disabled:{before:new Date(new Date().setHours(0,0,0,0))},className:"p-0 border rounded-md w-auto inline-block shadow-sm",footer:c.length>0?(0,t.jsxs)("p",{className:"text-xs text-blue-700 pt-1",children:[c.length," dia(s) selecionado(s)."]}):null})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(E._,{htmlFor:"start-time-modal",className:"font-medium text-gray-800",children:"In\xedcio*"}),(0,t.jsxs)(b.Ph,{value:p,onValueChange:x,children:[(0,t.jsx)(b.i4,{id:"start-time-modal",className:(0,u.cn)("h-9",J&&"border-red-500"),children:(0,t.jsx)(b.ki,{})}),(0,t.jsx)(b.Bw,{children:V.map(e=>(0,t.jsx)(b.Ql,{value:e,children:e},"st"+e))})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(E._,{htmlFor:"end-time-modal",className:"font-medium text-gray-800",children:"T\xe9rmino*"}),(0,t.jsxs)(b.Ph,{value:f,onValueChange:g,children:[(0,t.jsx)(b.i4,{id:"end-time-modal",className:(0,u.cn)("h-9",J&&"border-red-500"),children:(0,t.jsx)(b.ki,{})}),(0,t.jsx)(b.Bw,{children:V.map(e=>(0,t.jsx)(b.Ql,{value:e,children:e},"et"+e))})]})]}),J&&(0,t.jsx)("p",{className:"text-red-600 text-xs col-span-2 pt-1",children:J})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(E._,{htmlFor:"state-modal",className:"font-medium text-gray-800",children:"Estado*"}),(0,t.jsxs)(b.Ph,{value:M,onValueChange:z,children:[(0,t.jsx)(b.i4,{id:"state-modal",className:"h-9",children:(0,t.jsx)(b.ki,{placeholder:"UF..."})}),(0,t.jsx)(b.Bw,{children:A.map(e=>(0,t.jsx)(b.Ql,{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(E._,{htmlFor:"city-modal",className:"font-medium text-gray-800",children:"Cidade*"}),(0,t.jsxs)(b.Ph,{value:F,onValueChange:Z,disabled:!M||!G.length,children:[(0,t.jsx)(b.i4,{id:"city-modal",className:"h-9",children:(0,t.jsx)(b.ki,{placeholder:M?G.length?"Selecione...":"Sem cidades":"Selec. Estado"})}),(0,t.jsx)(b.Bw,{children:G.map(e=>(0,t.jsx)(b.Ql,{value:e,children:e},e))})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(E._,{htmlFor:"service-type-modal",className:"font-medium text-gray-800",children:"Tipo Atend.*"}),(0,t.jsxs)(b.Ph,{value:X,onValueChange:Q,children:[(0,t.jsx)(b.i4,{id:"service-type-modal",className:"h-9",children:(0,t.jsx)(b.ki,{placeholder:"Selecione..."})}),(0,t.jsx)(b.Bw,{children:T.map(e=>(0,t.jsx)(b.Ql,{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(E._,{htmlFor:"offered-rate-modal",className:"font-medium text-gray-800",children:"Valor Hora (R$)*"}),(0,t.jsx)(w.I,{id:"offered-rate-modal",type:"number",min:"0.01",step:"0.01",placeholder:"150.00",value:W,onChange:e=>Y(e.target.value),className:"h-9"})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsxs)(E._,{className:"flex items-center gap-1.5 font-medium text-gray-800",children:[(0,t.jsx)(I.Z,{className:"h-4 w-4"}),"Especialidades Requeridas (Opcional)"]}),(0,t.jsxs)(S.J2,{open:N,onOpenChange:D,children:[(0,t.jsx)(S.xo,{asChild:!0,children:(0,t.jsx)(i.z,{variant:"outline",className:"w-full justify-start font-normal text-muted-foreground h-9",children:_.length>0?_.join(", "):"Nenhuma (clique p/ adicionar)"})}),(0,t.jsx)(S.yk,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,t.jsxs)(R.mY,{children:[(0,t.jsx)(R.sZ,{placeholder:"Buscar...",value:U,onValueChange:q}),(0,t.jsxs)(R.e8,{children:[(0,t.jsx)(R.rb,{children:"Nenhuma especialidade encontrada."}),(0,t.jsx)(R.fu,{children:et.map(e=>(0,t.jsx)(R.di,{value:e,onSelect:()=>ea(e),className:"cursor-pointer",children:e},e))})]})]})})]}),_.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:_.map(e=>(0,t.jsxs)(m.C,{variant:"secondary",className:"bg-gray-100 hover:bg-gray-200",children:[e,(0,t.jsx)("button",{type:"button",onClick:()=>es(e),className:"ml-1.5 p-0.5 rounded-full outline-none focus:ring-1 focus:ring-ring hover:bg-gray-300",children:(0,t.jsx)(P.Z,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},e))})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(E._,{htmlFor:"notes-modal",className:"font-medium text-gray-800",children:"Notas Adicionais"}),(0,t.jsx)(C.g,{id:"notes-modal",placeholder:"Ex: Entrada pela Portaria B, procurar por Enfermeira Maria...",value:$,onChange:e=>K(e.target.value)})]})]}),(0,t.jsxs)(n.cN,{className:"mt-2 pt-4 border-t",children:[" ",(0,t.jsx)(n.GG,{asChild:!0,children:(0,t.jsx)(i.z,{type:"button",variant:"outline",disabled:j,children:"Cancelar"})}),(0,t.jsxs)(i.z,{type:"button",onClick:er,disabled:j,children:[j&&(0,t.jsx)(k.Z,{className:"mr-2 h-4 w-4 animate-spin"})," Publicar Vaga(s)"]})]})]})};var _=s(2385);function B(){let{toast:e}=(0,l.pm)(),[a,s]=(0,r.useState)([]),[m,u]=(0,r.useState)(!0),[h,p]=(0,r.useState)(null),[x,f]=(0,r.useState)(!1),g=(0,r.useCallback)(async()=>{u(!0),p(null);try{let e=await (0,d.G2)();s(e.sort((e,a)=>e.date.getTime()-a.date.getTime()||e.startTime.localeCompare(a.startTime)))}catch(a){console.error("Error fetching open shifts:",a),p(a.message||"Erro ao buscar vagas."),e({title:"Erro ao Buscar Vagas",description:a.message,variant:"destructive"})}finally{u(!1)}},[e]);(0,r.useEffect)(()=>{g()},[g]);let j=async a=>{if(a)try{await (0,d.CW)(a),e({title:"Vaga Cancelada",variant:"default"}),g()}catch(a){e({title:"Erro ao Cancelar",description:a.message||"Falha",variant:"destructive"})}};return(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Vagas em Aberto"}),(0,t.jsxs)(n.Vq,{open:x,onOpenChange:f,children:[(0,t.jsx)(n.hg,{asChild:!0,children:(0,t.jsxs)(i.z,{size:"sm",children:[(0,t.jsx)(c.Z,{className:"mr-2 h-4 w-4"})," Publicar Nova Vaga"]})}),(0,t.jsx)(D,{onShiftAdded:()=>{f(!1),g()}})]})]}),m?(0,t.jsx)(_.Gu,{message:"Carregando vagas abertas..."}):h?(0,t.jsx)(_.Te,{message:h,onRetry:g}):0===a.length?(0,t.jsx)(_.ub,{message:"Nenhuma vaga aberta encontrada."}):(0,t.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,t.jsx)(N,{shift:e,actions:[{label:"Cancelar",icon:o.Z,onClick:()=>j(e.id),variant:"ghost",className:"text-red-600 hover:text-red-700 hover:bg-red-50 rounded-full w-8 h-8"}]},e.id))})]})}},33569:function(e,a,s){"use strict";s.d(a,{AX:function(){return n},CW:function(){return o},G2:function(){return c},N_:function(){return x},S$:function(){return d},YY:function(){return u},d5:function(){return h},iC:function(){return m},m3:function(){return p},or:function(){return f},xf:function(){return l}});var t=s(5978),r=s(17293),i=s(92651);let l=async e=>{let a=r.I8.currentUser;if(!a)throw Error("Usu\xe1rio n\xe3o autenticado.");let s=await (0,i.Ts)();if(!s||"hospital"!==s.role)throw Error("Perfil de hospital n\xe3o encontrado ou inv\xe1lido.");let l={...e,hospitalId:a.uid,hospitalName:s.displayName,publishedByUID:a.uid,publishedByName:a.displayName||s.displayName||void 0,status:"OPEN",createdAt:(0,t.Bt)(),updatedAt:(0,t.Bt)()};try{let e=await (0,t.ET)((0,t.hJ)(r.db,"shiftRequirements"),l);return console.log("[SERVICE] Nova Demanda de Plant\xe3o adicionada com ID: ",e.id),e.id}catch(e){throw console.error("[SERVICE] Erro ao adicionar demanda:",e),e}},n=async(e,a)=>{if(!r.I8.currentUser)throw Error("Usu\xe1rio n\xe3o autenticado.");let s=(0,t.JU)(r.db,"shiftRequirements",e);try{await (0,t.r7)(s,{...a,updatedAt:(0,t.Bt)()}),console.log("[SERVICE] Demanda ID:",e,"atualizada.")}catch(e){throw console.error("[SERVICE] Erro ao atualizar demanda:",e),e}},c=async()=>{let e=r.I8.currentUser;if(!e)return[];try{let a=(0,t.IO)((0,t.hJ)(r.db,"shiftRequirements"),(0,t.ar)("hospitalId","==",e.uid),(0,t.ar)("status","==","OPEN"),(0,t.Xo)("createdAt","desc")),s=await (0,t.PL)(a),i=[];return s.forEach(e=>{i.push({id:e.id,...e.data()})}),console.log("[SERVICE] getHospitalShiftRequirements (OPEN): Encontradas ".concat(i.length," demandas.")),i}catch(e){throw console.error("[SERVICE] Erro getHospitalShiftRequirements:",e),e}},o=async e=>{if(!r.I8.currentUser)throw Error("Usu\xe1rio n\xe3o autenticado.");try{await (0,t.oe)((0,t.JU)(r.db,"shiftRequirements",e)),console.log("[SERVICE] Demanda deletada ID:",e)}catch(e){throw console.error("[SERVICE] Erro ao deletar demanda:",e),e}},d=async e=>{if(!e)throw Error("ID do hospital n\xe3o fornecido.");return{kpis:{},monthlyCosts:[],specialtyDemand:[]}},m=async()=>[],u=async()=>[],h=async()=>[],p=async()=>{let e=r.I8.currentUser;if(!e)return[];try{let a=(0,t.hJ)(r.db,"users",e.uid,"hospitalDoctors"),s=(0,t.IO)(a,(0,t.Xo)("name","asc")),i=await (0,t.PL)(s);if(i.empty)return[];return i.docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Erro ao buscar m\xe9dicos gerenciados:",e),[]}},x=async(e,a)=>{if(!e||!a.crm||!a.name)throw Error("Dados insuficientes para cadastrar o m\xe9dico (Nome e CRM s\xe3o obrigat\xf3rios).");let s=(0,t.hJ)(r.db,"users");await (0,t.i3)(r.db,async i=>{if(a.email){let e=(0,t.IO)(s,(0,t.ar)("email","==",a.email));if(!(await (0,t.PL)(e)).empty)throw Error("O email ".concat(a.email," j\xe1 est\xe1 cadastrado na plataforma."))}let l=(0,t.IO)(s,(0,t.ar)("professionalCrm","==",a.crm));if(!(await (0,t.PL)(l)).empty)throw Error("O CRM ".concat(a.crm," j\xe1 est\xe1 cadastrado na plataforma."));let n=(0,t.JU)((0,t.hJ)(r.db,"users"));i.set(n,{displayName:a.name,email:a.email||"",professionalCrm:a.crm,phone:a.phone||"",specialties:a.specialties||[],role:"doctor",documentVerificationStatus:"PENDING_DOCUMENTS",onboardingMethod:"EXTERNAL_HOSPITAL_INVITE",onboardedByHospitalId:e,createdAt:(0,t.Bt)(),updatedAt:(0,t.Bt)()});let c=(0,t.JU)((0,t.hJ)(r.db,"users",e,"hospitalDoctors"),n.id);i.set(c,{id:n.id,name:a.name,crm:a.crm,email:a.email||"",phone:a.phone||"",specialties:a.specialties||[],status:"ACTIVE_EXTERNAL",source:"EXTERNAL",addedAt:(0,t.Bt)()})})},f=async(e,a,s)=>(console.log("[SERVICE] Hospital ".concat(e," atualizando m\xe9dico ").concat(a," (MOCK):"),s),await new Promise(e=>setTimeout(e,400)),{success:!0,message:"Dados do m\xe9dico ".concat(s.name||a," atualizados (mock).")})}},function(e){e.O(0,[4358,9990,6137,9084,1543,7877,8398,6879,5343,2496,5837,9348,2971,2117,1744],function(){return e(e.s=85938)}),_N_E=e.O()}]);