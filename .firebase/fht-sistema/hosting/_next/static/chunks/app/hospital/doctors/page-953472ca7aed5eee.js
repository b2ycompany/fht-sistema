(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1380],{38265:function(e,r,t){Promise.resolve().then(t.bind(t,88611))},88611:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return E}});var a=t(57437),s=t(2265),o=t(46413),i=t(35153),n=t(13491),c=t(17293),l=t(92651),d=t(16850),u=t(62869),h=t(66070),f=t(95186),m=t(26110),p=t(57054),x=t(23518),v=t(19060),j=t(35974),g=t(73247),y=t(55909),w=t(32489),N=t(51817),b=t(98335),S=t(37806);let A=e=>{var r;let{onAssociationSuccess:t}=e,{toast:l}=(0,i.pm)(),[h,S]=(0,s.useState)(""),[A,E]=(0,s.useState)([]),[C,k]=(0,s.useState)([]),[P,I]=(0,s.useState)([]),[R,Z]=(0,s.useState)(!1),[T,V]=(0,s.useState)(null),U=(0,d.N)(h,500),z=null===(r=(0,o.a)().user)||void 0===r?void 0:r.uid;(0,s.useEffect)(()=>{(async()=>{if(z)try{let e=(0,n.V1)(c.wk,"searchAssociatedDoctors"),r=(await e({searchTerm:"",specialtiesFilter:[]})).data.doctors.flatMap(e=>e.specialties||[]),t=Array.from(new Set(r)).sort();k(t)}catch(e){console.error("Erro ao buscar especialidades:",e)}})()},[z]),(0,s.useEffect)(()=>{(async()=>{if(U.length<3&&0===A.length){I([]);return}Z(!0);try{let e=(0,n.V1)(c.wk,"searchAssociatedDoctors"),r=await e({searchTerm:U,specialtiesFilter:A});I(r.data.doctors)}catch(e){l({title:"Erro na Busca",description:e.message,variant:"destructive"}),I([])}finally{Z(!1)}})()},[U,A,l]);let O=async e=>{V(e);try{let r=(0,n.V1)(c.wk,"associateDoctorToUnit");await r({doctorId:e}),l({title:"Sucesso!",description:"M\xe9dico associado \xe0 sua unidade.",className:"bg-green-600 text-white"}),t()}catch(e){l({title:"Erro ao Associar",description:e.message,variant:"destructive"})}finally{V(null)}};return(0,a.jsxs)(m.cZ,{className:"sm:max-w-2xl",children:[(0,a.jsxs)(m.fK,{children:[(0,a.jsx)(m.$N,{children:"Associar M\xe9dico Vinculado"}),(0,a.jsx)(m.Be,{children:"Procure por um m\xe9dico que j\xe1 tenha v\xednculo com a sua unidade para associ\xe1-lo a um agendamento."})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 py-4",children:[(0,a.jsxs)("div",{className:"relative flex-grow",children:[(0,a.jsx)(g.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(f.I,{placeholder:"Digite nome, CRM ou email",value:h,onChange:e=>S(e.target.value),className:"pl-9"})]}),(0,a.jsxs)(p.J2,{children:[(0,a.jsx)(p.xo,{asChild:!0,children:(0,a.jsxs)(u.z,{variant:"outline",className:"shrink-0",children:[(0,a.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),"Filtrar (",A.length,")"]})}),(0,a.jsx)(p.yk,{className:"w-64 p-0",children:(0,a.jsxs)(x.mY,{children:[(0,a.jsx)(x.sZ,{placeholder:"Buscar especialidade..."}),(0,a.jsx)(x.rb,{children:"Nenhuma especialidade encontrada."}),(0,a.jsx)(x.fu,{children:C.map(e=>(0,a.jsxs)(x.di,{onSelect:()=>{E(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},children:[(0,a.jsx)(v.X,{className:"mr-2",checked:A.includes(e)}),(0,a.jsx)("span",{children:e})]},e))})]})})]})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1 items-center mb-2",children:A.map(e=>(0,a.jsxs)(j.C,{variant:"secondary",children:[e,(0,a.jsx)("button",{onClick:()=>E(r=>r.filter(r=>r!==e)),className:"ml-1",children:(0,a.jsx)(w.Z,{className:"h-3 w-3"})})]},e))}),(0,a.jsxs)("div",{className:"mt-4 max-h-64 overflow-y-auto space-y-2",children:[R&&(0,a.jsx)("div",{className:"flex justify-center p-4",children:(0,a.jsx)(N.Z,{className:"h-6 w-6 animate-spin"})}),!R&&P.length>0&&P.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["CRM: ",e.crm||"N\xe3o informado"]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.specialties.map(e=>(0,a.jsx)(j.C,{variant:"outline",children:e},e))})]}),(0,a.jsxs)(u.z,{size:"sm",onClick:()=>O(e.uid),disabled:T===e.uid,children:[T===e.uid?(0,a.jsx)(N.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Associar"]})]},e.uid)),!R&&(U.length>=3||A.length>0)&&0===P.length&&(0,a.jsx)("p",{className:"text-center text-sm text-muted-foreground py-4",children:"Nenhum resultado encontrado para os filtros aplicados."})]})]})};function E(){let{user:e}=(0,o.a)(),[r,t]=(0,s.useState)([]),[i,n]=(0,s.useState)(!0),[c,d]=(0,s.useState)(!1),f=(0,s.useCallback)(async()=>{if(e){n(!0);try{let r=await (0,l.l5)(e.uid);t(r.filter(e=>"doctor"===e.userType))}catch(e){console.error("Erro ao buscar m\xe9dicos associados:",e)}finally{n(!1)}}},[e]);return(0,s.useEffect)(()=>{f()},[f]),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Gest\xe3o de M\xe9dicos"}),(0,a.jsxs)(m.Vq,{open:c,onOpenChange:d,children:[(0,a.jsx)(m.hg,{asChild:!0,children:(0,a.jsxs)(u.z,{children:[(0,a.jsx)(S.Z,{className:"mr-2 h-4 w-4"})," Associar M\xe9dico"]})}),(0,a.jsx)(A,{onAssociationSuccess:()=>{d(!1),f()}})]})]}),(0,a.jsxs)(h.Zb,{children:[(0,a.jsxs)(h.Ol,{children:[(0,a.jsx)(h.ll,{children:"M\xe9dicos Associados \xe0 Unidade"}),(0,a.jsx)(h.SZ,{children:"Esta \xe9 a lista de m\xe9dicos que j\xe1 t\xeam v\xednculo com a sua unidade."})]}),(0,a.jsx)(h.aY,{children:i?(0,a.jsx)("div",{className:"flex justify-center p-8",children:(0,a.jsx)(N.Z,{className:"h-8 w-8 animate-spin"})}):r.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(e=>{var r;return(0,a.jsxs)(h.Zb,{children:[(0,a.jsxs)(h.Ol,{children:[(0,a.jsx)(h.ll,{children:e.displayName}),(0,a.jsx)(h.SZ,{children:e.professionalCrm||"CRM n\xe3o informado"})]}),(0,a.jsx)(h.aY,{children:(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:null===(r=e.specialties)||void 0===r?void 0:r.map(e=>(0,a.jsx)(j.C,{variant:"secondary",children:e},e))})})]},e.uid)})}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nenhum m\xe9dico associado a esta unidade."})})})]})]})}},46413:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return l},a:function(){return d}});var a=t(57437),s=t(2265),o=t(43301),i=t(17293),n=t(92651);let c=(0,s.createContext)(void 0),l=e=>{let{children:r}=e,[t,l]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[h,f]=(0,s.useState)(!0),[m,p]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{console.log("[AuthProvider] Subscribing to onAuthStateChanged (montagem do provider)");let e=(0,o.Aj)(i.I8,async e=>{if(console.log("[AuthProvider] onAuthStateChanged: User state changed. New Firebase user:",e?e.uid:null),l(e),e){p(!0);try{let e=await (0,n.Ts)();u(e),console.log("[AuthProvider] onAuthStateChanged: Profile fetched after user state change:",e)}catch(e){console.error("[AuthProvider] onAuthStateChanged: Error fetching profile:",e),u(null)}finally{p(!1)}}else u(null),p(!1);f(!1),console.log("[AuthProvider] onAuthStateChanged: Loading set to false.")});return()=>{console.log("[AuthProvider] Unsubscribing from onAuthStateChanged (desmontagem do provider)"),e()}},[]),console.log("[AuthProvider] Context values updated - User:",t?t.uid:null,"Loading:",h,"ProfileLoading:",m),(0,a.jsx)(c.Provider,{value:{user:t,userProfile:d,loading:h,profileLoading:m},children:r})},d=()=>{let e=(0,s.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},66070:function(e,r,t){"use strict";t.d(r,{Ol:function(){return n},SZ:function(){return l},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return c}});var a=t(57437),s=t(2265),o=t(94508);let i=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})});i.displayName="Card";let n=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",t),...s})});n.displayName="CardHeader";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",t),...s})});c.displayName="CardTitle";let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,o.cn)("text-sm text-muted-foreground",t),...s})});l.displayName="CardDescription";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,o.cn)("p-6 pt-0",t),...s})});d.displayName="CardContent";let u=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,o.cn)("flex items-center p-6 pt-0",t),...s})});u.displayName="CardFooter"},19060:function(e,r,t){"use strict";t.d(r,{X:function(){return c}});var a=t(57437),s=t(2265),o=t(9270),i=t(30401),n=t(94508);let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(o.fC,{ref:r,className:(0,n.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:(0,a.jsx)(o.z$,{className:(0,n.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})})});c.displayName=o.fC.displayName},16850:function(e,r,t){"use strict";t.d(r,{N:function(){return s}});var a=t(2265);function s(e,r){let[t,s]=(0,a.useState)(e);return(0,a.useEffect)(()=>{let t=setTimeout(()=>{s(e)},r);return()=>{clearTimeout(t)}},[e,r]),t}},92651:function(e,r,t){"use strict";t.d(r,{CQ:function(){return d},Fl:function(){return x},TX:function(){return h},Ts:function(){return m},XB:function(){return n},bI:function(){return p},c0:function(){return f},hc:function(){return v},l5:function(){return c},pH:function(){return u},q9:function(){return l}});var a=t(43301),s=t(5978),o=t(17293);let i=(0,t(13491).V1)(o.wk,"createStaffUser"),n=async e=>{try{let r=await i(e);if(!r.data.success)throw Error("A fun\xe7\xe3o de backend n\xe3o retornou sucesso.");return r.data.user}catch(e){throw console.error("[AuthService] Erro ao chamar a fun\xe7\xe3o createStaffUser:",e),Error(e.message||"N\xe3o foi poss\xedvel adicionar o membro \xe0 Equipa.")}},c=async e=>{try{let r=(0,s.hJ)(o.db,"users"),t=(0,s.IO)(r,(0,s.ar)("hospitalId","==",e)),a=await (0,s.PL)(t);if(a.empty)return[];return a.docs.map(e=>({uid:e.id,...e.data()})).filter(r=>r.uid!==e)}catch(r){throw console.error("[AuthService] Erro ao buscar a Equipa para o hospital ".concat(e,":"),r),Error("N\xe3o foi poss\xedvel carregar a lista da Equipa.")}},l=async(e,r,t)=>{try{let s=await (0,a.Xb)(o.I8,e,r);return await (0,a.ck)(s.user,{displayName:t}),s.user}catch(e){throw console.error("[AuthService] Erro ao criar usu\xe1rio no Auth:",e),e}},d=async(e,r,t,a,i)=>{let n={};if("doctor"===a){let{documents:e,specialistDocuments:r,...t}=i;n={...t,documents:e,specialistDocuments:r,documentVerificationStatus:"PENDING_REVIEW",adminVerificationNotes:""}}else if("hospital"===a){let{hospitalDocs:e,legalRepDocuments:r,...t}=i;n={companyInfo:{cnpj:t.cnpj,stateRegistration:t.stateRegistration,phone:t.phone,address:t.address},legalRepresentativeInfo:t.legalRepresentativeInfo,hospitalDocs:e,legalRepDocuments:r,documentVerificationStatus:"PENDING_REVIEW",adminVerificationNotes:""}}else if(["receptionist","triage_nurse","caravan_admin","admin","backoffice"].includes(a))n={};else throw Error("Tipo de perfil de registro inv\xe1lido.");let c={uid:e,email:r,displayName:t,userType:a,createdAt:(0,s.Bt)(),updatedAt:(0,s.Bt)(),...n};await (0,s.pl)((0,s.JU)(o.db,"users",e),c),console.log("[AuthService] Perfil ".concat(a," salvo para UID: ").concat(e))},u=async(e,r)=>{try{return(await (0,a.e5)(o.I8,e,r)).user}catch(e){throw console.error("[AuthService] Login error:",e),e}},h=async()=>{try{await (0,a.w7)(o.I8)}catch(e){throw console.error("[AuthService] Logout error:",e),e}},f=async e=>{try{await (0,a.LS)(o.I8,e)}catch(e){throw console.error("[AuthService] Reset error:",e),e}},m=async()=>{let e=o.I8.currentUser;if(!e)return null;try{let r=(0,s.JU)(o.db,"users",e.uid),t=await (0,s.QT)(r);if(t.exists())return{uid:t.id,...t.data()};return null}catch(e){throw console.error("[AuthService] Get current user data error:",e),e}},p=async(e,r)=>{if(!e)throw Error("ID do Doutor n\xe3o fornecido para atualiza\xe7\xe3o.");if(!r||0===Object.keys(r).length){console.warn("[AuthService] Nenhum dado fornecido para atualiza\xe7\xe3o do perfil do doutor.");return}let t=(0,s.JU)(o.db,"users",e),a={};if(Object.keys(r).forEach(e=>{void 0!==r[e]&&("address"===e&&"object"==typeof r.address&&null!==r.address?Object.keys(r.address).forEach(e=>{void 0!==r.address[e]&&(a["address.".concat(e)]=r.address[e])}):a[e]=r[e])}),0===Object.keys(a).length){console.warn("[AuthService] Nenhum dado v\xe1lido para atualizar ap\xf3s filtrar undefined.");return}a.updatedAt=(0,s.Bt)();try{var i;let r=await (0,s.QT)(t);if(!r.exists()||(null===(i=r.data())||void 0===i?void 0:i.userType)!=="doctor")throw Error("Perfil de doutor n\xe3o encontrado ou tipo de usu\xe1rio incorreto para atualiza\xe7\xe3o.");await (0,s.r7)(t,a),console.log("[AuthService] Perfil do doutor ".concat(e," atualizado com sucesso."))}catch(r){throw console.error("[AuthService] Erro ao atualizar perfil do doutor ".concat(e,":"),r),r}},x=async(e,r)=>{try{let t=(0,s.hJ)(o.db,"users"),a=(0,s.IO)(t,(0,s.ar)("userType","==","doctor"),(0,s.ar)("specialties","array-contains",r),(0,s.ar)("healthUnitIds","array-contains",e)),i=await (0,s.PL)(a);if(i.empty)return[];return i.docs.map(e=>({uid:e.id,...e.data()}))}catch(e){throw console.error("[AuthService] Erro ao buscar m\xe9dicos associados por especialidade:",e),Error("N\xe3o foi poss\xedvel carregar a lista de m\xe9dicos para esta unidade.")}},v=async function(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw Error("ID do usu\xe1rio n\xe3o fornecido.");let i=(0,s.JU)(o.db,"users",e),n={documentVerificationStatus:r,adminVerificationNotes:t,documentRejectionReasons:a,updatedAt:(0,s.Bt)()};"APPROVED"===r&&(n.documentRejectionReasons={},n.adminVerificationNotes="");try{await (0,s.r7)(i,n)}catch(r){throw console.error("Erro ao atualizar status do usu\xe1rio ".concat(e,":"),r),Error("Falha ao atualizar o status do cadastro.")}}}},function(e){e.O(0,[4358,9990,6137,9084,9733,6838,6008,2592,4189,7271,2971,2117,1744],function(){return e(e.s=38265)}),_N_E=e.O()}]);