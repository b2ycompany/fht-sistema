(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1390],{18278:function(e,a,s){Promise.resolve().then(s.bind(s,52661))},52661:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return U}});var l=s(57437),t=s(2265),r=s(99376),i=s(902),n=s(92651),c=s(46413),o=s(44667),d=s(31209),m=s(92369),u=s(48662),x=s(60730),h=s(29374),p=s(88178),g=s(51817),f=s(87133),j=s(65621),v=s(54159),y=s(48736),N=s(92735),b=s(14760),w=s(83229),k=s(76865),S=s(62869),E=s(76818),Z=s(26815),C=s(66070),z=s(12339),A=s(35153),P=s(65402),O=s(27648),I=s(26110);let _=(0,t.memo)(e=>{let{id:a}=e,s=(0,o.aV)(a),r=(0,t.useRef)(null),i=null==s?void 0:s.tracks.video.persistentTrack;return(0,t.useEffect)(()=>{r.current&&i?r.current.srcObject=new MediaStream([i]):r.current&&(r.current.srcObject=null)},[i]),(0,l.jsxs)("div",{className:"relative aspect-video bg-gray-800 rounded-lg overflow-hidden shadow-lg h-full w-full",children:[" ",(0,l.jsx)("video",{autoPlay:!0,muted:null==s?void 0:s.local,playsInline:!0,ref:r,className:"w-full h-full object-cover"}),!i&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"flex flex-col items-center gap-2 text-gray-400",children:[(0,l.jsx)(m.Z,{className:"w-16 h-16"}),(0,l.jsx)("p",{className:"font-bold",children:(null==s?void 0:s.user_name)||"Participante"}),(0,l.jsx)("p",{className:"text-xs",children:"C\xe2mera desligada"})]})}),(0,l.jsx)("div",{className:"absolute bottom-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded",children:(null==s?void 0:s.local)?"Voc\xea":(null==s?void 0:s.user_name)||"Participante"})]})});_.displayName="VideoTile";let D=(0,t.memo)(e=>{let{callObject:a}=e,s=(0,o.j1)(),i=(0,r.useRouter)(),[n,c]=(0,t.useState)(!1);if((0,o.VU)("left-meeting",(0,t.useCallback)(()=>{console.log("Evento 'left-meeting' recebido."),i.push("/dashboard/agenda")},[i])),!a)return null;let d=(0,t.useCallback)(async()=>{c(!0);try{await a.leave()}catch(e){console.error("Erro ao tentar sair da chamada:",e),i.push("/dashboard/agenda")}finally{c(!1)}},[a,i]);return(0,l.jsxs)("div",{className:"flex justify-center items-center gap-3 p-4 bg-gray-800/80 backdrop-blur-sm border-t border-gray-700 rounded-t-xl",children:[(0,l.jsx)(S.z,{onClick:()=>a.setLocalAudio(!(null==s?void 0:s.audio)),variant:"outline",size:"icon",className:"bg-gray-700 hover:bg-gray-600 border-gray-600 rounded-full h-12 w-12 text-white",children:(null==s?void 0:s.audio)?(0,l.jsx)(u.Z,{size:20}):(0,l.jsx)(x.Z,{size:20,className:"text-red-500"})}),(0,l.jsx)(S.z,{onClick:()=>a.setLocalVideo(!(null==s?void 0:s.video)),variant:"outline",size:"icon",className:"bg-gray-700 hover:bg-gray-600 border-gray-600 rounded-full h-12 w-12 text-white",children:(null==s?void 0:s.video)?(0,l.jsx)(h.Z,{size:20}):(0,l.jsx)(p.Z,{size:20,className:"text-red-500"})}),(0,l.jsx)(S.z,{onClick:d,variant:"destructive",size:"icon",className:"rounded-full h-14 w-14",disabled:n,children:n?(0,l.jsx)(g.Z,{className:"animate-spin"}):(0,l.jsx)(f.Z,{size:24})})]})});D.displayName="CallTray";let V=e=>{let{appointment:a,patientVideoTrack:s}=e,[r,i]=(0,t.useState)((null==a?void 0:a.aiAnalysisReport)||null),[n,c]=(0,t.useState)(!0);return((0,t.useEffect)(()=>{if(null==a?void 0:a.aiAnalysisReport)i(a.aiAnalysisReport),c(!1);else if(a){let e=setTimeout(()=>{c(!1)},5e3);return()=>clearTimeout(e)}},[a]),n)?(0,l.jsxs)("div",{className:"text-center p-4",children:[(0,l.jsx)(g.Z,{className:"h-6 w-6 animate-spin mx-auto text-purple-300"}),(0,l.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Aguardando relat\xf3rio da Intelig\xeancia Artificial..."})]}):(0,l.jsxs)(C.Zb,{className:"bg-gray-700/50 border-gray-600",children:[(0,l.jsx)(C.Ol,{className:"pb-2",children:(0,l.jsx)(C.ll,{className:"text-base text-purple-300",children:"Relat\xf3rio Preliminar (IA)"})}),(0,l.jsx)(C.aY,{children:(0,l.jsx)("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:r||"Nenhum relat\xf3rio preliminar dispon\xedvel para esta consulta."})})]})},R=(0,t.memo)(e=>{let{appointment:a,userProfile:s,patientVideoTrack:r,refreshData:n}=e,{toast:c}=(0,A.pm)(),[o,d]=(0,t.useState)((null==a?void 0:a.clinicalEvolution)||""),[m,u]=(0,t.useState)((null==a?void 0:a.diagnosticHypothesis)||""),[x,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)(!1),[k,_]=(0,t.useState)(!1);(0,t.useEffect)(()=>{a&&(d(a.clinicalEvolution||""),u(a.diagnosticHypothesis||""))},[a]);let D=async()=>{if(a){h(!0);try{await (0,i.q)(a.id,{clinicalEvolution:o,diagnosticHypothesis:m}),c({title:"Sucesso!",description:"Prontu\xe1rio salvo."})}catch(e){c({title:"Erro ao Salvar",description:e.message,variant:"destructive"})}finally{h(!1)}}};return a&&s?(0,l.jsxs)(C.Zb,{className:"h-full flex flex-col bg-gray-800 border-gray-700 text-white overflow-hidden",children:[(0,l.jsx)(C.Ol,{className:"flex-shrink-0",children:(0,l.jsx)(C.ll,{className:"text-lg",children:"Prontu\xe1rio e An\xe1lise"})}),(0,l.jsxs)(C.aY,{className:"flex-grow flex flex-col gap-4 overflow-y-auto p-4",children:[" ",(0,l.jsxs)(z.mQ,{defaultValue:"atendimento",className:"flex-grow flex flex-col",children:[(0,l.jsxs)(z.dr,{className:"grid w-full grid-cols-4 bg-gray-900 sticky top-0 z-10",children:[(0,l.jsx)(z.SP,{value:"atendimento",children:"Atendimento"}),(0,l.jsx)(z.SP,{value:"paciente",children:"Paciente"}),(0,l.jsx)(z.SP,{value:"analise_ia",className:"text-purple-400",children:"An\xe1lise IA"}),(0,l.jsx)(z.SP,{value:"documentos",children:"Documentos"})]}),(0,l.jsxs)(z.nU,{value:"atendimento",className:"flex-grow flex flex-col gap-4 mt-4",children:[(0,l.jsxs)("div",{className:"space-y-1.5 flex flex-col flex-grow",children:[(0,l.jsx)(Z._,{htmlFor:"evolution",children:"Evolu\xe7\xe3o Cl\xednica"}),(0,l.jsx)(E.g,{id:"evolution",value:o,onChange:e=>d(e.target.value),className:"min-h-[150px] flex-grow bg-gray-700 border-gray-600 text-white placeholder-gray-400",placeholder:"Descreva a evolu\xe7\xe3o..."})]}),(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsx)(Z._,{htmlFor:"hypothesis",children:"Hip\xf3tese Diagn\xf3stica / Conduta"}),(0,l.jsx)(E.g,{id:"hypothesis",value:m,onChange:e=>u(e.target.value),className:"bg-gray-700 border-gray-600 text-white placeholder-gray-400",placeholder:"Descreva a hip\xf3tese..."})]})]}),(0,l.jsxs)(z.nU,{value:"paciente",className:"text-sm space-y-4 mt-4 flex-grow",children:[(0,l.jsxs)("div",{className:"p-3 bg-gray-700/50 rounded-md",children:[(0,l.jsx)(Z._,{className:"text-gray-400 block mb-1",children:"Nome"}),(0,l.jsx)("p",{className:"font-medium text-lg",children:a.patientName})]}),(0,l.jsxs)("div",{className:"p-3 bg-gray-700/50 rounded-md",children:[(0,l.jsx)(Z._,{className:"text-gray-400 block mb-1",children:"N\xba SUS"}),(0,l.jsx)("p",{children:a.patientSUSCard||(0,l.jsx)("span",{className:"italic text-gray-500",children:"N\xe3o informado"})})]}),(0,l.jsxs)("div",{className:"p-3 bg-gray-700/50 rounded-md",children:[(0,l.jsx)(Z._,{className:"text-gray-400 block mb-1",children:"Hist\xf3rico Resumido"}),(0,l.jsx)("p",{className:"whitespace-pre-wrap",children:a.patientMedicalHistorySummary||(0,l.jsx)("span",{className:"italic text-gray-500",children:"Sem resumo"})})]}),a.patientId?(0,l.jsxs)(I.Vq,{open:k,onOpenChange:_,children:[(0,l.jsx)(I.hg,{asChild:!0,children:(0,l.jsxs)(S.z,{variant:"outline",className:"w-full border-gray-600 text-gray-300 hover:bg-gray-700",children:[(0,l.jsx)(j.Z,{className:"mr-2 h-4 w-4"}),"Ver Hist\xf3rico Detalhado"]})}),(0,l.jsx)(P.K,{patientId:a.patientId,currentConsultationId:a.id})]}):(0,l.jsxs)(S.z,{variant:"outline",className:"w-full border-gray-600 text-gray-400",disabled:!0,children:[(0,l.jsx)(j.Z,{className:"mr-2 h-4 w-4"}),"Hist\xf3rico Indispon\xedvel (Sem ID do Paciente)"]})]}),(0,l.jsxs)(z.nU,{value:"documentos",className:"mt-4 space-y-4",children:[(0,l.jsxs)(I.Vq,{open:p,onOpenChange:f,children:[(0,l.jsx)(I.hg,{asChild:!0,children:(0,l.jsxs)(S.z,{variant:"outline",className:"w-full border-gray-600 text-gray-300 hover:bg-gray-700",children:[(0,l.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"Gerar Receita"]})}),(0,l.jsx)(I.cZ,{children:(0,l.jsx)("p",{children:"Modal de Prescri\xe7\xe3o (a implementar)"})})]}),(0,l.jsxs)("div",{className:"space-y-2 pt-4 border-t border-gray-700",children:[(0,l.jsx)("h3",{className:"text-sm font-semibold",children:"Documentos Anteriores"}),a.generatedDocuments&&a.generatedDocuments.length>0?a.generatedDocuments.map((e,a)=>{var s;return(0,l.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-700/50 border border-gray-600 rounded-md",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:["prescription"===e.type?(0,l.jsx)(v.Z,{className:"h-4 w-4 text-blue-400"}):(0,l.jsx)(y.Z,{className:"h-4 w-4 text-green-400"}),(0,l.jsx)("span",{className:"font-medium text-sm",children:e.name}),(0,l.jsxs)("span",{className:"text-xs text-gray-400",children:["(",(null===(s=e.createdAt)||void 0===s?void 0:s.toDate().toLocaleDateString("pt-BR"))||"Data?",")"]})]}),(0,l.jsx)(S.z,{asChild:!0,variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-300 hover:text-white",children:(0,l.jsx)(O.default,{href:e.url,target:"_blank",rel:"noopener noreferrer",children:(0,l.jsx)(N.Z,{className:"h-4 w-4"})})})]},a)}):(0,l.jsx)("p",{className:"text-xs text-center text-gray-500 py-4",children:"Nenhum documento."})]})]}),(0,l.jsxs)(z.nU,{value:"analise_ia",className:"mt-4 flex-grow",children:[(0,l.jsx)(V,{appointment:a,patientVideoTrack:r}),(0,l.jsxs)(C.Zb,{className:"mt-4 bg-gray-700/50 border-gray-600",children:[(0,l.jsx)(C.Ol,{className:"pb-2",children:(0,l.jsxs)(C.ll,{className:"text-base flex items-center gap-2",children:[(0,l.jsx)(b.Z,{})," Ferramentas de Avalia\xe7\xe3o"]})}),(0,l.jsxs)(C.aY,{className:"space-y-2",children:[(0,l.jsx)("p",{className:"text-xs text-gray-400",children:"Iniciar protocolos espec\xedficos."}),(0,l.jsx)(S.z,{variant:"secondary",className:"w-full bg-purple-600 hover:bg-purple-700 text-white",disabled:!0,children:"Iniciar Protocolo TOC (em breve)"})]})]})]})]}),(0,l.jsx)("div",{className:"mt-auto pt-4 border-t border-gray-700 flex-shrink-0",children:(0,l.jsxs)(S.z,{onClick:D,disabled:x,className:"w-full bg-blue-600 hover:bg-blue-700",children:[x?(0,l.jsx)(g.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,l.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Salvar Anota\xe7\xf5es"]})})]})]}):(0,l.jsx)(C.Zb,{className:"h-full flex items-center justify-center p-4 bg-gray-800 border-gray-700 text-white",children:(0,l.jsx)(g.Z,{className:"h-6 w-6 animate-spin"})})});R.displayName="ElectronicHealthRecordEnhanced",(0,t.memo)(()=>{let e=(0,o.OV)({filter:"remote"});return(0,l.jsx)("div",{className:"grid grid-cols-1 gap-4 h-full w-full",children:e.map(e=>(0,l.jsx)(_,{id:e},e))})}).displayName="ParticipantRenderer";let T=e=>{var a;let{callObject:s}=e,{user:d}=(0,c.a)(),m=(0,r.useRouter)(),u=(0,r.useParams)().appointmentId,[x,h]=(0,t.useState)(null),[p,f]=(0,t.useState)(null),[j,v]=(0,t.useState)(!0),[y,N]=(0,t.useState)(null),[b,w]=(0,t.useState)(null),E=(0,o.OV)({filter:"remote"}),Z=(0,o.aV)(E[0]);(0,t.useEffect)(()=>{(null==Z?void 0:Z.tracks.video.persistentTrack)?w(Z.tracks.video.persistentTrack):w(null)},[Z]);let C=(0,t.useCallback)(async()=>{if(u&&d)try{let[e,a]=await Promise.all([(0,i.sO)(u),(0,n.Ts)()]);if(!e)throw Error("Agendamento n\xe3o encontrado.");if(e.doctorId!==d.uid)throw Error("Acesso n\xe3o permitido.");if(!e.telemedicineRoomUrl)throw Error("Link inv\xe1lido.");h(e),f(a),N(null),s&&"new"===s.meetingState()&&await s.join({url:e.telemedicineRoomUrl,userName:(null==a?void 0:a.displayName)||"M\xe9dico(a)"})}catch(e){console.error("Erro ao carregar dados da consulta:",e),N(e.message||"Falha ao carregar a sala.")}finally{v(!1)}},[u,s,d]);return((0,t.useEffect)(()=>{v(!0),C()},[C]),j)?(0,l.jsxs)("div",{className:"h-screen flex items-center justify-center bg-gray-900 text-white",children:[(0,l.jsx)(g.Z,{className:"h-12 w-12 animate-spin text-blue-400"}),(0,l.jsx)("p",{className:"ml-4",children:"Carregando consulta..."})]}):y?(0,l.jsxs)("div",{className:"h-screen flex flex-col items-center justify-center bg-gray-900 text-white p-4",children:[(0,l.jsx)(k.Z,{className:"h-12 w-12 text-red-400"}),(0,l.jsx)("p",{className:"mt-4 text-center",children:y}),(0,l.jsx)(S.z,{onClick:()=>m.push("/dashboard/agenda"),className:"mt-4",children:"Voltar para Agenda"})]}):(0,l.jsxs)("div",{className:"w-full h-screen bg-gray-900 text-white flex flex-col md:flex-row gap-4 p-4 overflow-hidden",children:[(0,l.jsx)("div",{className:"w-full md:w-2/5 xl:w-1/3 h-full overflow-y-auto",children:(0,l.jsx)(R,{appointment:x,userProfile:p,patientVideoTrack:b,refreshData:C})}),(0,l.jsxs)("div",{className:"w-full md:w-3/5 xl:w-2/3 h-full flex flex-col gap-4",children:[(0,l.jsxs)("header",{className:"flex justify-between items-center flex-shrink-0",children:[(0,l.jsx)("h1",{className:"text-xl font-bold",children:"Atendimento Telemedicina"}),x&&(0,l.jsxs)("p",{className:"text-sm text-gray-400",children:["Paciente: ",x.patientName]})]}),(0,l.jsxs)("main",{className:"flex-grow flex flex-col items-center justify-center overflow-hidden bg-black rounded-lg relative",children:[0===E.length?(0,l.jsxs)("div",{className:"text-center text-gray-400 p-8",children:[(0,l.jsx)(g.Z,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),"Aguardando o paciente..."]}):(0,l.jsx)("div",{className:"relative w-full h-full flex items-center justify-center",children:(0,l.jsx)(_,{id:E[0]},E[0])}),(0,l.jsx)("div",{className:"absolute bottom-20 right-4 w-1/4 max-w-[200px] z-20 border-2 border-gray-700 rounded-md shadow-lg",children:(0,l.jsx)(_,{id:(null===(a=(0,o.j1)())||void 0===a?void 0:a.session_id)||"local"})})]}),(0,l.jsx)("footer",{className:"flex-shrink-0 z-10",children:(0,l.jsx)(D,{callObject:s})})]})]})};function U(){let[e,a]=(0,t.useState)(null);return((0,t.useEffect)(()=>{let e=d.ZP.createCallObject();return a(e),()=>{e.leave().finally(()=>{e.destroy()})}},[]),e)?(0,l.jsx)(o.Eu,{callObject:e,children:(0,l.jsx)(T,{callObject:e})}):(0,l.jsxs)("div",{className:"h-screen flex items-center justify-center bg-gray-900 text-white",children:[(0,l.jsx)(g.Z,{className:"h-12 w-12 animate-spin"}),(0,l.jsx)("p",{className:"ml-4",children:"Inicializando v\xeddeo..."})]})}},902:function(e,a,s){"use strict";s.d(a,{Pc:function(){return n},q:function(){return o},sO:function(){return c}});var l=s(17293),t=s(1850),r=s(5978);let i=(0,t.V1)(l.wk,"createAppointment"),n=async e=>{try{let a={...e,appointmentDate:e.appointmentDate.toISOString()},s=await i(a);if(!s.data.success||!s.data.appointmentId)throw Error("A Cloud Function n\xe3o retornou um resultado de sucesso.");return s.data.appointmentId}catch(e){throw Error(e.message||"N\xe3o foi poss\xedvel concluir o agendamento.")}},c=async e=>{try{let a=(0,r.JU)(l.db,"appointments",e),s=await (0,r.QT)(a);if(s.exists())return{id:s.id,...s.data()};return null}catch(e){throw Error("Falha ao carregar os dados do agendamento.")}},o=async(e,a)=>{try{let s=(0,r.JU)(l.db,"appointments",e);await (0,r.r7)(s,{clinicalEvolution:a.clinicalEvolution,diagnosticHypothesis:a.diagnosticHypothesis,updatedAt:(0,r.Bt)()})}catch(e){throw Error("N\xe3o foi poss\xedvel salvar as anota\xe7\xf5es do prontu\xe1rio.")}}}},function(e){e.O(0,[3609,9015,1878,6137,9388,5844,7648,266,9027,4517,4701,1635,3073,6252,2971,2117,1744],function(){return e(e.s=18278)}),_N_E=e.O()}]);