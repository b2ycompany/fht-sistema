(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1390],{75410:function(){},48628:function(){},31601:function(){},67792:function(){},34977:function(){},75042:function(){},18278:function(e,a,t){Promise.resolve().then(t.bind(t,9751))},9751:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return K}});var s=t(57437),r=t(2265),l=t(99376),o=t(902),i=t(92651),n=t(46413),c=t(44667),d=t(31209),m=t(17293),u=t(5978);let x=async e=>{try{let a=(0,u.JU)(m.db,"diagnosticProtocols",e),t=await (0,u.QT)(a);if(t.exists())return{id:t.id,...t.data()};return console.warn('[ProtocolService] Protocolo com ID "'.concat(e,'" n\xe3o encontrado.')),null}catch(a){throw console.error('[ProtocolService] Erro ao buscar protocolo "'.concat(e,'":'),a),Error("N\xe3o foi poss\xedvel carregar o protocolo de diagn\xf3stico.")}};var h=t(35153),p=t(51817),f=t(83229),v=t(66070),g=t(26815),j=t(74991),y=t(76818),N=t(62869);let b=e=>{let{protocolId:a,appointmentId:t,initialAnswers:l}=e,{toast:i}=(0,h.pm)(),[n,c]=(0,r.useState)(null),[d,m]=(0,r.useState)(l||{}),[u,b]=(0,r.useState)(!0),[w,S]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{b(!0);try{let e=await x(a);c(e)}catch(e){i({title:"Erro",description:"N\xe3o foi poss\xedvel carregar as perguntas do protocolo.",variant:"destructive"})}finally{b(!1)}})()},[a,i]);let A=(e,a)=>{m(t=>({...t,[e]:a}))},C=async()=>{if(0===Object.keys(d).length){i({title:"Nenhuma resposta",description:"Nenhuma resposta foi alterada para salvar.",variant:"default"});return}S(!0);try{await (0,o.fW)(t,d),i({title:"Sucesso!",description:"Respostas do protocolo salvas."})}catch(e){i({title:"Erro ao Salvar",description:"N\xe3o foi poss\xedvel salvar as respostas.",variant:"destructive"})}finally{S(!1)}};return u?(0,s.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,s.jsx)(p.Z,{className:"h-6 w-6 animate-spin"})}):n?(0,s.jsxs)(v.Zb,{className:"bg-gray-900/50 border-gray-700",children:[(0,s.jsxs)(v.Ol,{children:[(0,s.jsx)(v.ll,{children:n.title}),(0,s.jsx)(v.SZ,{children:n.description})]}),(0,s.jsxs)(v.aY,{className:"space-y-6",children:[n.questions.map((e,a)=>(0,s.jsxs)("div",{className:"p-4 border-b border-gray-700 last:border-b-0",children:[(0,s.jsxs)(g._,{className:"font-semibold text-base",children:[a+1,". ",e.text]}),(0,s.jsxs)("div",{className:"mt-3",children:["multiple_choice"===e.type&&e.options&&(0,s.jsx)(j.E,{value:d[e.id]||"",onValueChange:a=>A(e.id,a),className:"space-y-2",children:e.options.map(a=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(j.m,{value:a,id:"".concat(e.id,"-").concat(a)}),(0,s.jsx)(g._,{htmlFor:"".concat(e.id,"-").concat(a),className:"font-normal cursor-pointer",children:a})]},a))}),"text_input"===e.type&&(0,s.jsx)(y.g,{value:d[e.id]||"",onChange:a=>A(e.id,a.target.value),placeholder:e.placeholder||"Digite sua observa\xe7\xe3o...",className:"bg-gray-900 border-gray-600"})]})]},e.id)),(0,s.jsx)("div",{className:"flex justify-end pt-4",children:(0,s.jsxs)(N.z,{onClick:C,disabled:w,children:[w?(0,s.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Salvar Respostas do Protocolo"]})})]})]}):(0,s.jsx)("p",{className:"text-red-500 text-center",children:"Protocolo de diagn\xf3stico n\xe3o encontrado."})};var w=t(70320),S=t(7315),A=t(42208),C=t(1740);let E=(0,r.memo)(e=>{let{videoTrack:a,onMetricsFinalized:t}=e,l=(0,r.useRef)(null),o=(0,r.useRef)(),i=(0,r.useRef)(null),n=(0,r.useRef)(null),[c,d]=(0,r.useState)({eyeContactScore:0,headMovement:0,isModelReady:!1,statusMessage:"A inicializar TensorFlow.js..."});return(0,r.useEffect)(()=>{a&&l.current&&(l.current.srcObject=new MediaStream([a]),l.current.play().catch(e=>console.error("Erro ao reproduzir v\xeddeo para an\xe1lise:",e)))},[a]),(0,r.useEffect)(()=>{let e=async()=>{if(l.current&&i.current&&l.current.readyState>=3){let e=l.current,a=await i.current.estimateFaces(e);if(a.length>0){let e=a[0].keypoints,t=e.find(e=>"noseTip"===e.name),s=0;if(t&&n.current){let e=t.x-n.current.x,a=t.y-n.current.y;s=Math.sqrt(e*e+a*a),n.current={x:t.x,y:t.y}}else t&&(n.current={x:t.x,y:t.y});let r=e.find(e=>"leftEyeUpper1"===e.name),l=e.find(e=>"rightEyeUpper1"===e.name),o=!1;(null==r?void 0:r.z)&&(null==l?void 0:l.z)&&(o=10>Math.abs(r.z-l.z)),d(e=>({...e,eyeContactScore:o?Math.min(100,e.eyeContactScore+.5):Math.max(0,e.eyeContactScore-.5),headMovement:e.headMovement+s}))}}o.current=requestAnimationFrame(e)};return(async()=>{try{await w.Cd_(),d(e=>({...e,statusMessage:"A carregar modelo de detec\xe7\xe3o facial..."}));let a=S.oV.MediaPipeFaceMesh,t=await S.cH(a,{runtime:"mediapipe",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh",maxFaces:1,refineLandmarks:!0});i.current=t,d(e=>({...e,isModelReady:!0,statusMessage:"Modelo pronto. A analisar..."})),o.current=requestAnimationFrame(e)}catch(e){console.error("Falha ao carregar o modelo de IA:",e),d(e=>({...e,statusMessage:"Erro ao carregar modelo."}))}})(),()=>{o.current&&cancelAnimationFrame(o.current),i.current&&i.current.dispose(),t({eyeContactScore:c.eyeContactScore,headMovement:c.headMovement})}},[]),(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-gray-900/50 border border-gray-700 h-full",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"An\xe1lise Comportamental em Tempo Real"}),(0,s.jsx)("video",{ref:l,className:"hidden"}),c.isModelReady?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(A.Z,{className:"h-5 w-5 mr-3 text-blue-400"}),(0,s.jsx)("span",{className:"text-white",children:"Estimativa de Contato Visual"})]}),(0,s.jsx)("div",{className:"w-1/3 bg-gray-700 rounded-full h-2.5",children:(0,s.jsx)("div",{className:"bg-blue-400 h-2.5 rounded-full",style:{width:"".concat(c.eyeContactScore,"%")}})}),(0,s.jsxs)("span",{className:"font-bold text-lg text-blue-300 w-16 text-right",children:[c.eyeContactScore.toFixed(0),"%"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(C.Z,{className:"h-5 w-5 mr-3 text-purple-400"}),(0,s.jsx)("span",{className:"text-white",children:"Ac\xfamulo de Movimento (Cabe\xe7a)"})]}),(0,s.jsx)("span",{className:"font-bold text-lg text-purple-300",children:c.headMovement.toFixed(0)})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 pt-2",children:"Estes dados s\xe3o estimativas geradas por IA para apoiar a observa\xe7\xe3o cl\xednica e n\xe3o constituem um diagn\xf3stico."})]}):(0,s.jsxs)("div",{className:"flex items-center text-yellow-400",children:[(0,s.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}),(0,s.jsx)("span",{children:c.statusMessage})]})]})});E.displayName="RealTimeAnalysis";let k=(e,a)=>{let t=[];t.push("RELAT\xd3RIO DE APOIO GERADO POR IA\nData: "+new Date().toLocaleDateString("pt-BR")),t.push("------------------------------------");let s="An\xe1lise do Protocolo de Triagem:\n";if(e.q1_eye_contact){let a=e.q1_eye_contact;a.includes("Raramente")?s+="- O protocolo indica que o contato visual foi raramente ou nunca mantido.\n":a.includes("inconstante")&&(s+="- O protocolo aponta para um contato visual inconstante.\n")}if(e.q4_repetitive_movements){let a=e.q4_repetitive_movements;a.includes("frequente")?s+="- Foram reportados movimentos corporais repetitivos de forma frequente ou intensa.\n":a.includes("leve")&&(s+="- Foram reportados movimentos corporais repetitivos de forma leve ou ocasional.\n")}e.q5_speech_patterns&&e.q5_speech_patterns.length>2&&(s+="- Observa\xe7\xf5es sobre a fala: ".concat(e.q5_speech_patterns,"\n")),t.push(s);let r="An\xe1lise Comportamental por V\xeddeo (Estimativas):\n";return a.eyeContactScore<40?r+="- O \xedndice de contato visual direto com a c\xe2mera foi baixo (".concat(a.eyeContactScore.toFixed(0),"%).\n"):a.eyeContactScore<70?r+="- O \xedndice de contato visual direto com a c\xe2mera foi moderado (".concat(a.eyeContactScore.toFixed(0),"%).\n"):r+="- O \xedndice de contato visual direto com a c\xe2mera foi consistente (".concat(a.eyeContactScore.toFixed(0),"%).\n"),a.headMovement>1500?r+="- Foi detetado um alto volume de movimento da cabe\xe7a durante a consulta (\xedndice: ".concat(a.headMovement.toFixed(0),").\n"):a.headMovement>800?r+="- O volume de movimento da cabe\xe7a foi moderado (\xedndice: ".concat(a.headMovement.toFixed(0),").\n"):r+="- O volume de movimento da cabe\xe7a foi baixo (\xedndice: ".concat(a.headMovement.toFixed(0),").\n"),t.push(r),t.push("------------------------------------"),t.push("NOTA: Este relat\xf3rio \xe9 uma ferramenta de apoio baseada em dados observacionais e estimativas de IA. N\xe3o substitui a avalia\xe7\xe3o e o julgamento cl\xednico do profissional de sa\xfade."),t.join("\n")};var _=t(82222);let O=e=>{let{appointment:a,patientVideoTrack:t}=e,{toast:l}=(0,h.pm)(),[i,n]=(0,r.useState)(null),[c,d]=(0,r.useState)(a.aiAnalysisReport||""),[m,u]=(0,r.useState)(!1),x=async()=>{if(!c){l({title:"Aten\xe7\xe3o",description:"Nenhum relat\xf3rio foi gerado para salvar.",variant:"destructive"});return}u(!0);try{await (0,o.ps)(a.id,c),l({title:"Sucesso",description:"Relat\xf3rio de apoio da IA salvo no prontu\xe1rio."})}catch(e){l({title:"Erro",description:e.message,variant:"destructive"})}finally{u(!1)}};return(0,s.jsxs)("div",{className:"space-y-6 h-full",children:[(0,s.jsx)(E,{videoTrack:t,onMetricsFinalized:n}),(0,s.jsx)("div",{className:"flex-grow",children:(0,s.jsx)(b,{protocolId:"ASD_screening_v1",appointmentId:a.id,initialAnswers:a.autismProtocolAnswers})}),(0,s.jsxs)("div",{className:"space-y-3 pt-4 border-t border-gray-700",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Relat\xf3rio Consolidado da IA"}),(0,s.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,s.jsxs)(N.z,{onClick:()=>{if(!a.autismProtocolAnswers){l({title:"Aten\xe7\xe3o",description:"Por favor, preencha e salve as respostas do protocolo primeiro.",variant:"destructive"});return}if(!i){l({title:"Aten\xe7\xe3o",description:"Os dados de an\xe1lise de v\xeddeo ainda n\xe3o foram finalizados. A an\xe1lise para quando a chamada \xe9 encerrada ou a aba \xe9 trocada.",variant:"destructive"});return}d(k(a.autismProtocolAnswers,i)),l({title:"Relat\xf3rio Gerado",description:"O resumo da IA foi criado com base nos dados coletados."})},children:[(0,s.jsx)(_.Z,{className:"mr-2 h-4 w-4"}),"Gerar Relat\xf3rio de Apoio"]}),(0,s.jsxs)(N.z,{onClick:x,disabled:m||!c,variant:"outline",children:[m?(0,s.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Salvar Relat\xf3rio no Prontu\xe1rio"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(g._,{htmlFor:"ai-report-output",children:"Resumo da An\xe1lise"}),(0,s.jsx)(y.g,{id:"ai-report-output",value:c,readOnly:!0,className:"bg-gray-950 text-gray-300 font-mono h-56 resize-none",placeholder:"Clique em 'Gerar Relat\xf3rio' para ver o resumo da IA aqui..."})]})]})]})};var P=t(92369),R=t(48662),Z=t(60730),z=t(29374),M=t(88178),I=t(87133),F=t(65621),D=t(54159),q=t(48736),T=t(92735),V=t(14760),U=t(76865),H=t(12339),L=t(65402),B=t(27648),G=t(26110);let J=(0,r.memo)(e=>{let{id:a}=e,t=(0,c.aV)(a),l=(0,r.useRef)(null),o=null==t?void 0:t.tracks.video.persistentTrack;return(0,r.useEffect)(()=>{l.current&&o?l.current.srcObject=new MediaStream([o]):l.current&&(l.current.srcObject=null)},[o]),(0,s.jsxs)("div",{className:"relative aspect-video bg-gray-800 rounded-lg overflow-hidden shadow-lg h-full w-full",children:[" ",(0,s.jsx)("video",{autoPlay:!0,muted:null==t?void 0:t.local,playsInline:!0,ref:l,className:"w-full h-full object-cover"}),!o&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2 text-gray-400",children:[(0,s.jsx)(P.Z,{className:"w-16 h-16"}),(0,s.jsx)("p",{className:"font-bold",children:(null==t?void 0:t.user_name)||"Participante"}),(0,s.jsx)("p",{className:"text-xs",children:"C\xe2mera desligada"})]})}),(0,s.jsx)("div",{className:"absolute bottom-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded",children:(null==t?void 0:t.local)?"Voc\xea":(null==t?void 0:t.user_name)||"Participante"})]})});J.displayName="VideoTile";let Q=(0,r.memo)(e=>{let{callObject:a}=e,t=(0,c.j1)(),o=(0,l.useRouter)(),[i,n]=(0,r.useState)(!1);if((0,c.VU)("left-meeting",(0,r.useCallback)(()=>{console.log("Evento 'left-meeting' recebido."),o.push("/dashboard/agenda")},[o])),!a)return null;let d=(0,r.useCallback)(async()=>{n(!0);try{await a.leave()}catch(e){console.error("Erro ao tentar sair da chamada:",e),o.push("/dashboard/agenda")}finally{n(!1)}},[a,o]);return(0,s.jsxs)("div",{className:"flex justify-center items-center gap-3 p-4 bg-gray-800/80 backdrop-blur-sm border-t border-gray-700 rounded-t-xl",children:[(0,s.jsx)(N.z,{onClick:()=>a.setLocalAudio(!(null==t?void 0:t.audio)),variant:"outline",size:"icon",className:"bg-gray-700 hover:bg-gray-600 border-gray-600 rounded-full h-12 w-12 text-white",children:(null==t?void 0:t.audio)?(0,s.jsx)(R.Z,{size:20}):(0,s.jsx)(Z.Z,{size:20,className:"text-red-500"})}),(0,s.jsx)(N.z,{onClick:()=>a.setLocalVideo(!(null==t?void 0:t.video)),variant:"outline",size:"icon",className:"bg-gray-700 hover:bg-gray-600 border-gray-600 rounded-full h-12 w-12 text-white",children:(null==t?void 0:t.video)?(0,s.jsx)(z.Z,{size:20}):(0,s.jsx)(M.Z,{size:20,className:"text-red-500"})}),(0,s.jsx)(N.z,{onClick:d,variant:"destructive",size:"icon",className:"rounded-full h-14 w-14",disabled:i,children:i?(0,s.jsx)(p.Z,{className:"animate-spin"}):(0,s.jsx)(I.Z,{size:24})})]})});Q.displayName="CallTray";let Y=(0,r.memo)(e=>{let{appointment:a,userProfile:t,patientVideoTrack:l,refreshData:i}=e,{toast:n}=(0,h.pm)(),[c,d]=(0,r.useState)((null==a?void 0:a.clinicalEvolution)||""),[m,u]=(0,r.useState)((null==a?void 0:a.diagnosticHypothesis)||""),[x,j]=(0,r.useState)(!1),[b,w]=(0,r.useState)(!1),[S,A]=(0,r.useState)(!1);(0,r.useEffect)(()=>{a&&(d(a.clinicalEvolution||""),u(a.diagnosticHypothesis||""))},[a]);let C=async()=>{if(a){j(!0);try{await (0,o.q)(a.id,{clinicalEvolution:c,diagnosticHypothesis:m}),n({title:"Sucesso!",description:"Prontu\xe1rio salvo."})}catch(e){n({title:"Erro ao Salvar",description:e.message,variant:"destructive"})}finally{j(!1)}}};return a&&t?(0,s.jsxs)(v.Zb,{className:"h-full flex flex-col bg-gray-800 border-gray-700 text-white overflow-hidden",children:[(0,s.jsx)(v.Ol,{className:"flex-shrink-0",children:(0,s.jsx)(v.ll,{className:"text-lg",children:"Prontu\xe1rio e An\xe1lise"})}),(0,s.jsxs)(v.aY,{className:"flex-grow flex flex-col gap-4 overflow-y-auto p-4",children:[" ",(0,s.jsxs)(H.mQ,{defaultValue:"atendimento",className:"flex-grow flex flex-col",children:[(0,s.jsxs)(H.dr,{className:"grid w-full grid-cols-4 bg-gray-900 sticky top-0 z-10",children:[(0,s.jsx)(H.SP,{value:"atendimento",children:"Atendimento"}),(0,s.jsx)(H.SP,{value:"paciente",children:"Paciente"}),(0,s.jsx)(H.SP,{value:"analise_ia",className:"text-purple-400",children:"An\xe1lise IA"}),(0,s.jsx)(H.SP,{value:"documentos",children:"Documentos"})]}),(0,s.jsxs)(H.nU,{value:"atendimento",className:"flex-grow flex flex-col gap-4 mt-4",children:[(0,s.jsxs)("div",{className:"space-y-1.5 flex flex-col flex-grow",children:[(0,s.jsx)(g._,{htmlFor:"evolution",children:"Evolu\xe7\xe3o Cl\xednica"}),(0,s.jsx)(y.g,{id:"evolution",value:c,onChange:e=>d(e.target.value),className:"min-h-[150px] flex-grow bg-gray-700 border-gray-600 text-white placeholder-gray-400",placeholder:"Descreva a evolu\xe7\xe3o..."})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)(g._,{htmlFor:"hypothesis",children:"Hip\xf3tese Diagn\xf3stica / Conduta"}),(0,s.jsx)(y.g,{id:"hypothesis",value:m,onChange:e=>u(e.target.value),className:"bg-gray-700 border-gray-600 text-white placeholder-gray-400",placeholder:"Descreva a hip\xf3tese..."})]})]}),(0,s.jsxs)(H.nU,{value:"paciente",className:"text-sm space-y-4 mt-4 flex-grow",children:[(0,s.jsxs)("div",{className:"p-3 bg-gray-700/50 rounded-md",children:[(0,s.jsx)(g._,{className:"text-gray-400 block mb-1",children:"Nome"}),(0,s.jsx)("p",{className:"font-medium text-lg",children:a.patientName})]}),(0,s.jsxs)("div",{className:"p-3 bg-gray-700/50 rounded-md",children:[(0,s.jsx)(g._,{className:"text-gray-400 block mb-1",children:"N\xba SUS"}),(0,s.jsx)("p",{children:a.patientSUSCard||(0,s.jsx)("span",{className:"italic text-gray-500",children:"N\xe3o informado"})})]}),(0,s.jsxs)("div",{className:"p-3 bg-gray-700/50 rounded-md",children:[(0,s.jsx)(g._,{className:"text-gray-400 block mb-1",children:"Hist\xf3rico Resumido"}),(0,s.jsx)("p",{className:"whitespace-pre-wrap",children:a.patientMedicalHistorySummary||(0,s.jsx)("span",{className:"italic text-gray-500",children:"Sem resumo"})})]}),a.patientId?(0,s.jsxs)(G.Vq,{open:S,onOpenChange:A,children:[(0,s.jsx)(G.hg,{asChild:!0,children:(0,s.jsxs)(N.z,{variant:"outline",className:"w-full border-gray-600 text-gray-300 hover:bg-gray-700",children:[(0,s.jsx)(F.Z,{className:"mr-2 h-4 w-4"}),"Ver Hist\xf3rico Detalhado"]})}),(0,s.jsx)(L.K,{patientId:a.patientId,currentConsultationId:a.id})]}):(0,s.jsxs)(N.z,{variant:"outline",className:"w-full border-gray-600 text-gray-400",disabled:!0,children:[(0,s.jsx)(F.Z,{className:"mr-2 h-4 w-4"}),"Hist\xf3rico Indispon\xedvel (Sem ID do Paciente)"]})]}),(0,s.jsxs)(H.nU,{value:"documentos",className:"mt-4 space-y-4",children:[(0,s.jsxs)(G.Vq,{open:b,onOpenChange:w,children:[(0,s.jsx)(G.hg,{asChild:!0,children:(0,s.jsxs)(N.z,{variant:"outline",className:"w-full border-gray-600 text-gray-300 hover:bg-gray-700",children:[(0,s.jsx)(D.Z,{className:"mr-2 h-4 w-4"}),"Gerar Receita"]})}),(0,s.jsx)(G.cZ,{children:(0,s.jsx)("p",{children:"Modal de Prescri\xe7\xe3o (a implementar)"})})]}),(0,s.jsxs)("div",{className:"space-y-2 pt-4 border-t border-gray-700",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold",children:"Documentos Anteriores"}),a.generatedDocuments&&a.generatedDocuments.length>0?a.generatedDocuments.map((e,a)=>{var t;return(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-700/50 border border-gray-600 rounded-md",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["prescription"===e.type?(0,s.jsx)(D.Z,{className:"h-4 w-4 text-blue-400"}):(0,s.jsx)(q.Z,{className:"h-4 w-4 text-green-400"}),(0,s.jsx)("span",{className:"font-medium text-sm",children:e.name}),(0,s.jsxs)("span",{className:"text-xs text-gray-400",children:["(",(null===(t=e.createdAt)||void 0===t?void 0:t.toDate().toLocaleDateString("pt-BR"))||"Data?",")"]})]}),(0,s.jsx)(N.z,{asChild:!0,variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-300 hover:text-white",children:(0,s.jsx)(B.default,{href:e.url,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)(T.Z,{className:"h-4 w-4"})})})]},a)}):(0,s.jsx)("p",{className:"text-xs text-center text-gray-500 py-4",children:"Nenhum documento."})]})]}),(0,s.jsxs)(H.nU,{value:"analise_ia",className:"mt-4 flex-grow",children:[(0,s.jsx)(O,{appointment:a,patientVideoTrack:l}),(0,s.jsxs)(v.Zb,{className:"mt-4 bg-gray-700/50 border-gray-600",children:[(0,s.jsx)(v.Ol,{className:"pb-2",children:(0,s.jsxs)(v.ll,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(V.Z,{})," Ferramentas de Avalia\xe7\xe3o"]})}),(0,s.jsxs)(v.aY,{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Iniciar protocolos espec\xedficos."}),(0,s.jsx)(N.z,{variant:"secondary",className:"w-full bg-purple-600 hover:bg-purple-700 text-white",disabled:!0,children:"Iniciar Protocolo TOC (em breve)"})]})]})]})]}),(0,s.jsx)("div",{className:"mt-auto pt-4 border-t border-gray-700 flex-shrink-0",children:(0,s.jsxs)(N.z,{onClick:C,disabled:x,className:"w-full bg-blue-600 hover:bg-blue-700",children:[x?(0,s.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Salvar Anota\xe7\xf5es"]})})]})]}):(0,s.jsx)(v.Zb,{className:"h-full flex items-center justify-center p-4 bg-gray-800 border-gray-700 text-white",children:(0,s.jsx)(p.Z,{className:"h-6 w-6 animate-spin"})})});Y.displayName="ElectronicHealthRecordEnhanced",(0,r.memo)(()=>{let e=(0,c.OV)({filter:"remote"});return(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4 h-full w-full",children:e.map(e=>(0,s.jsx)(J,{id:e},e))})}).displayName="ParticipantRenderer";let W=e=>{var a;let{callObject:t}=e,{user:d}=(0,n.a)(),m=(0,l.useRouter)(),u=(0,l.useParams)().appointmentId,[x,h]=(0,r.useState)(null),[f,v]=(0,r.useState)(null),[g,j]=(0,r.useState)(!0),[y,b]=(0,r.useState)(null),[w,S]=(0,r.useState)(null),A=(0,c.OV)({filter:"remote"}),C=(0,c.aV)(A[0]);(0,r.useEffect)(()=>{(null==C?void 0:C.tracks.video.persistentTrack)?S(C.tracks.video.persistentTrack):S(null)},[C]);let E=(0,r.useCallback)(async()=>{if(u&&d)try{let[e,a]=await Promise.all([(0,o.sO)(u),(0,i.Ts)()]);if(!e)throw Error("Agendamento n\xe3o encontrado.");if(e.doctorId!==d.uid)throw Error("Acesso n\xe3o permitido.");if(!e.telemedicineRoomUrl)throw Error("Link inv\xe1lido.");h(e),v(a),b(null),t&&"new"===t.meetingState()&&await t.join({url:e.telemedicineRoomUrl,userName:(null==a?void 0:a.displayName)||"M\xe9dico(a)"})}catch(e){console.error("Erro ao carregar dados da consulta:",e),b(e.message||"Falha ao carregar a sala.")}finally{j(!1)}},[u,t,d]);return((0,r.useEffect)(()=>{j(!0),E()},[E]),g)?(0,s.jsxs)("div",{className:"h-screen flex items-center justify-center bg-gray-900 text-white",children:[(0,s.jsx)(p.Z,{className:"h-12 w-12 animate-spin text-blue-400"}),(0,s.jsx)("p",{className:"ml-4",children:"Carregando consulta..."})]}):y?(0,s.jsxs)("div",{className:"h-screen flex flex-col items-center justify-center bg-gray-900 text-white p-4",children:[(0,s.jsx)(U.Z,{className:"h-12 w-12 text-red-400"}),(0,s.jsx)("p",{className:"mt-4 text-center",children:y}),(0,s.jsx)(N.z,{onClick:()=>m.push("/dashboard/agenda"),className:"mt-4",children:"Voltar para Agenda"})]}):(0,s.jsxs)("div",{className:"w-full h-screen bg-gray-900 text-white flex flex-col md:flex-row gap-4 p-4 overflow-hidden",children:[(0,s.jsx)("div",{className:"w-full md:w-2/5 xl:w-1/3 h-full overflow-y-auto",children:(0,s.jsx)(Y,{appointment:x,userProfile:f,patientVideoTrack:w,refreshData:E})}),(0,s.jsxs)("div",{className:"w-full md:w-3/5 xl:w-2/3 h-full flex flex-col gap-4",children:[(0,s.jsxs)("header",{className:"flex justify-between items-center flex-shrink-0",children:[(0,s.jsx)("h1",{className:"text-xl font-bold",children:"Atendimento Telemedicina"}),x&&(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["Paciente: ",x.patientName]})]}),(0,s.jsxs)("main",{className:"flex-grow flex flex-col items-center justify-center overflow-hidden bg-black rounded-lg relative",children:[0===A.length?(0,s.jsxs)("div",{className:"text-center text-gray-400 p-8",children:[(0,s.jsx)(p.Z,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),"Aguardando o paciente..."]}):(0,s.jsx)("div",{className:"relative w-full h-full flex items-center justify-center",children:(0,s.jsx)(J,{id:A[0]},A[0])}),(0,s.jsx)("div",{className:"absolute bottom-20 right-4 w-1/4 max-w-[200px] z-20 border-2 border-gray-700 rounded-md shadow-lg",children:(0,s.jsx)(J,{id:(null===(a=(0,c.j1)())||void 0===a?void 0:a.session_id)||"local"})})]}),(0,s.jsx)("footer",{className:"flex-shrink-0 z-10",children:(0,s.jsx)(Q,{callObject:t})})]})]})};function K(){let[e,a]=(0,r.useState)(null);return((0,r.useEffect)(()=>{let e=d.ZP.createCallObject();return a(e),()=>{e.leave().finally(()=>{e.destroy()})}},[]),e)?(0,s.jsx)(c.Eu,{callObject:e,children:(0,s.jsx)(W,{callObject:e})}):(0,s.jsxs)("div",{className:"h-screen flex items-center justify-center bg-gray-900 text-white",children:[(0,s.jsx)(p.Z,{className:"h-12 w-12 animate-spin"}),(0,s.jsx)("p",{className:"ml-4",children:"Inicializando v\xeddeo..."})]})}},74991:function(e,a,t){"use strict";t.d(a,{E:function(){return n},m:function(){return c}});var s=t(57437),r=t(2265),l=t(42325),o=t(40519),i=t(94508);let n=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.fC,{className:(0,i.cn)("grid gap-2",t),...r,ref:a})});n.displayName=l.fC.displayName;let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.ck,{ref:a,className:(0,i.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:(0,s.jsx)(l.z$,{className:"flex items-center justify-center",children:(0,s.jsx)(o.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});c.displayName=l.ck.displayName},902:function(e,a,t){"use strict";t.d(a,{Pc:function(){return i},fW:function(){return d},ps:function(){return m},q:function(){return c},sO:function(){return n}});var s=t(17293),r=t(1850),l=t(5978);let o=(0,r.V1)(s.wk,"createAppointment"),i=async e=>{try{let a={...e,appointmentDate:e.appointmentDate.toISOString()},t=await o(a);if(!t.data.success||!t.data.appointmentId)throw Error("A Cloud Function n\xe3o retornou um resultado de sucesso.");return t.data.appointmentId}catch(e){throw Error(e.message||"N\xe3o foi poss\xedvel concluir o agendamento.")}},n=async e=>{try{let a=(0,l.JU)(s.db,"appointments",e),t=await (0,l.QT)(a);if(t.exists())return{id:t.id,...t.data()};return null}catch(e){throw Error("Falha ao carregar os dados do agendamento.")}},c=async(e,a)=>{try{let t=(0,l.JU)(s.db,"appointments",e);await (0,l.r7)(t,{clinicalEvolution:a.clinicalEvolution,diagnosticHypothesis:a.diagnosticHypothesis,updatedAt:(0,l.Bt)()})}catch(e){throw Error("N\xe3o foi poss\xedvel salvar as anota\xe7\xf5es do prontu\xe1rio.")}},d=async(e,a)=>{try{let t=(0,l.JU)(s.db,"appointments",e);await (0,l.r7)(t,{autismProtocolAnswers:a,updatedAt:(0,l.Bt)()})}catch(e){throw Error("N\xe3o foi poss\xedvel salvar as respostas do protocolo.")}},m=async(e,a)=>{try{let t=(0,l.JU)(s.db,"appointments",e);await (0,l.r7)(t,{aiAnalysisReport:a,updatedAt:(0,l.Bt)()})}catch(e){throw Error("N\xe3o foi poss\xedvel salvar o relat\xf3rio da IA.")}}}},function(e){e.O(0,[3609,9015,7425,6399,8663,8566,6636,8938,6498,1878,6137,9388,5844,7648,266,9027,4517,4701,5396,3073,6252,2971,2117,1744],function(){return e(e.s=18278)}),_N_E=e.O()}]);