(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[267],{12326:function(e,t,a){Promise.resolve().then(a.bind(a,28451))},28451:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return P}});var r=a(57437),s=a(2265),o=a(99376),n=a(62869),i=a(66070),c=a(26110),l=a(35153),d=a(51817),u=a(43044),m=a(76865),f=a(69076),h=a(53581),p=a(58896),x=a(83774),g=a(88501),v=a(91723),N=a(92369),b=a(29090),y=a(47692),j=a(29374),w=a(5978),E=a(17293);let C=async()=>{let e=E.I8.currentUser;if(!e)throw Error("Utilizador n\xe3o autenticado.");let t=(0,w.hJ)(E.db,"contracts"),a=(0,w.IO)(t,(0,w.ar)("doctorId","==",e.uid),(0,w.ar)("status","in",["ACTIVE_SIGNED","IN_PROGRESS"])),r=await (0,w.PL)(a);if(r.empty)return[];let s=r.docs.map(async e=>{let t=e.data(),a="SCHEDULED";"IN_PROGRESS"===t.status&&(a="CHECKED_IN");let r={id:e.id,contractId:e.id,serviceType:t.serviceType,hospitalName:t.hospitalName,locationCity:t.locationCity,locationState:t.locationState,shiftDate:t.shiftDates[0],expectedStartTime:t.startTime,expectedEndTime:t.endTime,status:a,checkinAt:t.checkinAt,checkoutAt:t.checkoutAt,checkinLocation:t.checkinLocation,checkoutLocation:t.checkoutLocation};if("Telemedicina"===t.serviceType){let t=(0,w.IO)((0,w.hJ)(E.db,"consultations"),(0,w.ar)("contractId","==",e.id),(0,w.b9)(1)),a=await (0,w.PL)(t);if(!a.empty){let e=a.docs[0].data();r.patientName=e.patientName,r.chiefComplaint=e.chiefComplaint}}return r});return(await Promise.all(s)).sort((e,t)=>e.shiftDate.toMillis()-t.shiftDate.toMillis())},S=async(e,t,a,r)=>{if(!r)throw Error("A foto de verifica\xe7\xe3o \xe9 obrigat\xf3ria para o check-in.");let s=(0,w.JU)(E.db,"contracts",e);await (0,w.r7)(s,{checkinAt:(0,w.Bt)(),checkinLocation:{latitude:t,longitude:a},checkinPhotoUrl:r,status:"IN_PROGRESS",updatedAt:(0,w.Bt)()})},I=async(e,t,a)=>{let r=(0,w.JU)(E.db,"contracts",e);await (0,w.r7)(r,{checkoutAt:(0,w.Bt)(),checkoutLocation:{latitude:t,longitude:a},status:"COMPLETED",updatedAt:(0,w.Bt)()})};var A=a(87598),k=a(15822),D=a(94508),T=a(35974);let O=s.memo(e=>{let{message:t="A carregar os seus plant\xf5es..."}=e;return(0,r.jsxs)("div",{className:"flex flex-col justify-center items-center text-center py-10 min-h-[150px] w-full",children:[(0,r.jsx)(d.Z,{className:"h-8 w-8 animate-spin text-blue-600"}),(0,r.jsx)("p",{className:"mt-3 text-sm text-gray-600",children:t})]})}),R=s.memo(e=>{let{message:t}=e;return(0,r.jsxs)("div",{className:"text-center text-sm text-gray-500 py-10 min-h-[150px] flex flex-col items-center justify-center bg-gray-50/70 rounded-md border border-dashed border-gray-300 w-full",children:[(0,r.jsx)(u.Z,{className:"w-12 h-12 text-gray-400 mb-4"}),(0,r.jsx)("p",{className:"font-medium text-gray-600 mb-1",children:"Nenhum plant\xe3o encontrado"}),(0,r.jsx)("p",{className:"max-w-xs",children:t})]})}),z=s.memo(e=>{let{message:t,onRetry:a}=e;return(0,r.jsxs)("div",{className:"text-center text-sm text-red-600 py-10 min-h-[150px] flex flex-col items-center justify-center bg-red-50/70 rounded-md border border-dashed border-red-300 w-full",children:[(0,r.jsx)(m.Z,{className:"w-12 h-12 text-red-400 mb-4"}),(0,r.jsx)("p",{className:"font-semibold text-red-700 mb-1 text-base",children:"Oops! Algo deu errado."}),(0,r.jsx)("p",{className:"max-w-md text-red-600",children:t||"N\xe3o foi poss\xedvel carregar os dados."}),a&&(0,r.jsxs)(n.z,{variant:"destructive",size:"sm",onClick:a,className:"mt-4",children:[(0,r.jsx)(f.Z,{className:"mr-2 h-4 w-4"})," Tentar Novamente"]})]})}),U=(e,t)=>{var a;let r=e.split(","),s=null===(a=r[0].match(/:(.*?);/))||void 0===a?void 0:a[1],o=atob(r[1]),n=o.length,i=new Uint8Array(n);for(;n--;)i[n]=o.charCodeAt(n);return new File([i],t,{type:s})},_=e=>{let{isOpen:t,onClose:a,onCapture:o}=e,i=(0,s.useRef)(null),l=(0,s.useRef)(null),[u,m]=(0,s.useState)(!1),[f,p]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(!t)return;p(null),m(!1);let e=null;return(async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("O seu navegador n\xe3o suporta acesso \xe0 c\xe2mera.");e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}}),i.current&&(i.current.srcObject=e,i.current.onloadedmetadata=()=>{m(!0)})}catch(e){console.error("Erro ao aceder \xe0 c\xe2mera:",e),e instanceof DOMException&&"NotAllowedError"===e.name?p("Permiss\xe3o para aceder \xe0 c\xe2mera foi negada. Por favor, habilite-a nas configura\xe7\xf5es do seu navegador."):p("N\xe3o foi poss\xedvel aceder \xe0 c\xe2mera.")}})(),()=>{e&&e.getTracks().forEach(e=>e.stop()),i.current&&(i.current.srcObject=null),m(!1)}},[t]),(0,r.jsx)(c.Vq,{open:t,onOpenChange:a,children:(0,r.jsxs)(c.cZ,{children:[(0,r.jsxs)(c.fK,{children:[(0,r.jsx)(c.$N,{children:"Verifica\xe7\xe3o por Foto"}),(0,r.jsx)(c.Be,{children:"Centralize o seu rosto e capture a imagem para o check-in."})]}),(0,r.jsxs)("div",{className:"relative aspect-video w-full overflow-hidden rounded-md bg-gray-900 flex items-center justify-center",children:[f&&(0,r.jsx)("div",{className:"p-4 text-center text-sm text-red-100",children:f}),(0,r.jsx)("video",{ref:i,autoPlay:!0,playsInline:!0,className:(0,D.cn)("h-full w-full object-cover",{hidden:f})}),!u&&!f&&(0,r.jsx)(d.Z,{className:"h-8 w-8 animate-spin text-white absolute"}),(0,r.jsx)("canvas",{ref:l,className:"hidden"})]}),(0,r.jsxs)(n.z,{onClick:()=>{if(i.current&&l.current&&u){var e;let t=i.current,r=l.current;r.width=t.videoWidth,r.height=t.videoHeight,null===(e=r.getContext("2d"))||void 0===e||e.drawImage(t,0,0,t.videoWidth,t.videoHeight),o(r.toDataURL("image/jpeg",.9)),a()}},disabled:!u||!!f,children:[(0,r.jsx)(h.Z,{className:"mr-2 h-4 w-4"})," Capturar Foto"]})]})})},L=e=>{let{location:t}=e,[a,o]=(0,s.useState)("A obter nome do local...");return(0,s.useEffect)(()=>{t&&(async()=>{try{var e,a,r,s;let{latitude:n,longitude:i}=t,c=await fetch("https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=".concat(n,"&lon=").concat(i));if(!c.ok)throw Error("Falha na resposta da API de geolocaliza\xe7\xe3o");let l=await c.json(),d=(null===(e=l.address)||void 0===e?void 0:e.city)||(null===(a=l.address)||void 0===a?void 0:a.town)||(null===(r=l.address)||void 0===r?void 0:r.village),u=null===(s=l.address)||void 0===s?void 0:s.state;o(d&&u?"".concat(d,", ").concat(u):"Nome do local n\xe3o encontrado")}catch(e){console.error("Erro no reverse geocoding:",e),o("N\xe3o foi poss\xedvel obter o nome do local")}})()},[t]),(0,r.jsxs)("div",{className:"text-xs text-gray-500 flex items-center",children:[(0,r.jsx)(p.Z,{size:13,className:"mr-1.5"}),"Local registado: ",a]})};function P(){let{toast:e}=(0,l.pm)(),t=(0,o.useRouter)(),[a,n]=(0,s.useState)([]),[c,d]=(0,s.useState)(!0),[u,f]=(0,s.useState)(null),[h,p]=(0,s.useState)(null),[x,g]=(0,s.useState)(!1),[v,N]=(0,s.useState)(null),b=(0,s.useCallback)(async()=>{d(!0),f(null);try{let e=await C();n(e)}catch(e){f(e.message||"Falha ao carregar plant\xf5es.")}finally{d(!1)}},[]);(0,s.useEffect)(()=>{b()},[b]);let y=async a=>{p(a),e({title:"Preparando a sala de atendimento...",description:"Aguarde um momento."});try{await (0,A.yj)(a),t.push("/telemedicine/".concat(a))}catch(t){e({title:"Erro ao Iniciar Atendimento",description:t.message,variant:"destructive"})}finally{p(null)}},j=async t=>{p(t),navigator.geolocation.getCurrentPosition(async a=>{try{await I(t,a.coords.latitude,a.coords.longitude),e({title:"Check-out Realizado!",description:"O seu fim de plant\xe3o foi registado.",variant:"success"}),b()}catch(t){e({title:"Erro ao fazer Check-out",description:t.message,variant:"destructive"})}finally{p(null)}},t=>{e({title:"Falha na Geolocaliza\xe7\xe3o",description:"N\xe3o foi poss\xedvel obter sua localiza\xe7\xe3o para o checkout.",variant:"destructive"}),p(null)})},w=e=>{N(e),g(!0)};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(_,{isOpen:x,onClose:()=>g(!1),onCapture:t=>{if(!v||!E.I8.currentUser)return;let a=E.I8.currentUser.uid;p(v),e({title:"A obter a sua localiza\xe7\xe3o..."}),navigator.geolocation.getCurrentPosition(async r=>{let{latitude:s,longitude:o}=r.coords;try{e({title:"A enviar a sua foto..."});let r=U(t,"".concat(v,".jpg")),n="checkin_photos/".concat(a,"/").concat(v,".jpg"),i=await (0,k.v)(r,n);e({title:"A registar o seu check-in..."}),await S(v,s,o,i),e({title:"Check-in Realizado!",description:"O seu in\xedcio de plant\xe3o foi registado com sucesso.",variant:"success"}),b()}catch(t){e({title:"Erro no Processo de Check-in",description:t.message,variant:"destructive"})}finally{p(null)}},t=>{let a="N\xe3o foi poss\xedvel obter a sua localiza\xe7\xe3o. ";t.code===t.PERMISSION_DENIED?a+="Por favor, ative a permiss\xe3o de localiza\xe7\xe3o no seu navegador.":a+="Ocorreu um erro desconhecido.",e({title:"Falha na Geolocaliza\xe7\xe3o",description:a,variant:"destructive"}),p(null)},{timeout:15e3,enableHighAccuracy:!0})}}),(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-bold",children:"Check-in / Check-out de Plant\xf5es"}),(0,r.jsxs)(i.Zb,{children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{children:"Seus Pr\xf3ximos Plant\xf5es"}),(0,r.jsx)(i.SZ,{children:"Realize o check-in ao iniciar e o check-out ao finalizar seus plant\xf5es aqui."})]}),(0,r.jsxs)(i.aY,{children:[c&&(0,r.jsx)(O,{}),!c&&u&&(0,r.jsx)(z,{message:u,onRetry:b}),!c&&!u&&0===a.length&&(0,r.jsx)(R,{message:"Voc\xea n\xe3o tem plant\xf5es confirmados que requerem check-in/out."}),!c&&!u&&a.length>0&&(0,r.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,r.jsx)(F,{record:e,onCheckinClick:()=>w(e.id),onCheckoutClick:j,onStartTelemedicineClick:y,isActionLoading:h},e.id))})]})]}),(0,r.jsx)("div",{className:"mt-6 p-4 border rounded-lg bg-amber-50 text-amber-800",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(m.Z,{className:"h-5 w-5 mr-3 mt-0.5 text-amber-600"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:"Importante sobre Geolocaliza\xe7\xe3o e C\xe2mera"}),(0,r.jsx)("p",{className:"text-xs mt-1",children:"Para realizar o check-in, o seu navegador solicitar\xe1 permiss\xe3o para aceder \xe0 sua localiza\xe7\xe3o e c\xe2mera. Isto \xe9 necess\xe1rio para validar a sua presen\xe7a e identidade no local do plant\xe3o."})]})]})})]})}let F=e=>{let{record:t,onCheckinClick:a,onCheckoutClick:s,onStartTelemedicineClick:o,isActionLoading:c}=e,l=t.shiftDate.toDate(),u=c===t.id||c===t.contractId,m="Telemedicina"===t.serviceType,f=m&&("SCHEDULED"===t.status||"CHECKED_IN"===t.status),h=!m&&"SCHEDULED"===t.status,p=!m&&"CHECKED_IN"===t.status,w="CHECKED_OUT"===t.status,E=(e=>{switch(e){case"SCHEDULED":return{variant:"outline",className:"border-blue-300 text-blue-700 bg-blue-50"};case"CHECKED_IN":return{variant:"default",className:"bg-green-100 text-green-800 border-green-300"};case"CHECKED_OUT":return{variant:"secondary",className:"bg-gray-200 text-gray-700"};default:return{variant:"destructive",className:""}}})(t.status);return(0,r.jsxs)(i.Zb,{className:(0,D.cn)("shadow-sm transition-all","CHECKED_IN"===t.status&&"border-green-500 ring-2 ring-green-500/50"),children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsx)(i.ll,{className:"text-md mb-1",children:t.hospitalName}),(0,r.jsx)(T.C,{variant:E.variant,className:(0,D.cn)("capitalize",E.className),children:t.status.replace(/_/g," ").toLowerCase()})]}),(0,r.jsxs)(i.SZ,{className:"text-xs",children:[(0,r.jsx)(x.Z,{className:"inline h-3 w-3 mr-1 text-gray-500"}),"Local do Plant\xe3o: ",t.locationCity,", ",t.locationState]})]}),(0,r.jsxs)(i.aY,{className:"text-sm space-y-2 pt-4",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(g.Z,{size:14,className:"mr-2 text-gray-500"}),(0,r.jsx)("strong",{children:"Data:"}),(0,r.jsx)("span",{className:"ml-1",children:l.toLocaleDateString("pt-BR")})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(v.Z,{size:14,className:"mr-2 text-gray-500"}),(0,r.jsx)("strong",{children:"Hor\xe1rio Esperado:"}),(0,r.jsxs)("span",{className:"ml-1",children:[t.expectedStartTime," - ",t.expectedEndTime]})]}),m&&t.patientName&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-dashed",children:[(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Paciente Agendado"}),(0,r.jsxs)("div",{className:"p-3 bg-blue-50 rounded-md border border-blue-200 space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center font-semibold text-blue-900",children:[(0,r.jsx)(N.Z,{size:14,className:"mr-2"}),t.patientName]}),(0,r.jsx)("p",{className:"text-xs text-gray-700 pl-6",children:t.chiefComplaint})]})]}),t.checkinAt&&(0,r.jsxs)("div",{className:"pt-2 space-y-1",children:[(0,r.jsxs)("div",{className:"text-xs text-green-700 flex items-center",children:[(0,r.jsx)(b.Z,{size:13,className:"mr-1.5"}),"Check-in realizado \xe0s ",t.checkinAt.toDate().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]}),t.checkinLocation&&(0,r.jsx)(L,{location:t.checkinLocation})]}),t.checkoutAt&&(0,r.jsxs)("div",{className:"pt-2 space-y-1",children:[(0,r.jsxs)("div",{className:"text-xs text-red-700 flex items-center",children:[(0,r.jsx)(y.Z,{size:13,className:"mr-1.5"}),"Check-out realizado \xe0s ",t.checkoutAt.toDate().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]}),t.checkoutLocation&&(0,r.jsx)(L,{location:t.checkoutLocation})]})]}),(0,r.jsxs)(i.eW,{className:"flex justify-end gap-2 border-t pt-4",children:[f&&(0,r.jsxs)(n.z,{onClick:()=>o(t.contractId),size:"sm",className:"bg-blue-600 hover:bg-blue-700",disabled:u,children:[u&&(0,r.jsx)(d.Z,{className:"mr-2 h-4 w-4 animate-spin"}),(0,r.jsx)(j.Z,{className:"mr-2 h-4 w-4"})," Iniciar Atendimento"]}),h&&(0,r.jsxs)(n.z,{onClick:a,size:"sm",className:"bg-blue-600 hover:bg-blue-700",disabled:u,children:[u&&(0,r.jsx)(d.Z,{className:"mr-2 h-4 w-4 animate-spin"}),(0,r.jsx)(b.Z,{className:"mr-2 h-4 w-4"})," Fazer Check-in"]}),p&&(0,r.jsxs)(n.z,{onClick:()=>s(t.id),size:"sm",variant:"outline",disabled:u,children:[u&&(0,r.jsx)(d.Z,{className:"mr-2 h-4 w-4 animate-spin"}),(0,r.jsx)(y.Z,{className:"mr-2 h-4 w-4"})," Fazer Check-out"]}),w&&(0,r.jsx)(T.C,{variant:"default",className:"bg-green-100 text-green-800",children:"Plant\xe3o Finalizado"})]})]})}},35974:function(e,t,a){"use strict";a.d(t,{C:function(){return i}});var r=a(57437);a(2265);var s=a(90535),o=a(94508);let n=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,o.cn)(n({variant:a}),t),...s})}},62869:function(e,t,a){"use strict";a.d(t,{d:function(){return c},z:function(){return l}});var r=a(57437),s=a(2265),o=a(37053),n=a(90535),i=a(94508);let c=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,asChild:l=!1,...d}=e,u=l?o.g7:"button";return(0,r.jsx)(u,{className:(0,i.cn)(c({variant:s,size:n,className:a})),ref:t,...d})});l.displayName="Button"},66070:function(e,t,a){"use strict";a.d(t,{Ol:function(){return i},SZ:function(){return l},Zb:function(){return n},aY:function(){return d},eW:function(){return u},ll:function(){return c}});var r=a(57437),s=a(2265),o=a(94508);let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});n.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",a),...s})});i.displayName="CardHeader";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});c.displayName="CardTitle";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...s})});l.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",a),...s})});d.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",a),...s})});u.displayName="CardFooter"},26110:function(e,t,a){"use strict";a.d(t,{$N:function(){return x},Be:function(){return g},GG:function(){return u},Vq:function(){return c},cN:function(){return p},cZ:function(){return f},fK:function(){return h},hg:function(){return l}});var r=a(57437),s=a(2265),o=a(49027),n=a(32489),i=a(94508);let c=o.fC,l=o.xz,d=o.h_,u=o.x8,m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});m.displayName=o.aV.displayName;let f=s.forwardRef((e,t)=>{let{className:a,children:s,...c}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(m,{}),(0,r.jsxs)(o.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...c,children:[s,(0,r.jsxs)(o.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(n.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=o.VY.displayName;let h=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};h.displayName="DialogHeader";let p=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};p.displayName="DialogFooter";let x=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});x.displayName=o.Dx.displayName;let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})});g.displayName=o.dk.displayName},35153:function(e,t,a){"use strict";a.d(t,{pm:function(){return m}});var r=a(2265);let s=0,o=new Map,n=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?n(a):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],l={toasts:[]};function d(e){l=i(l,e),c.forEach(e=>{e(l)})}function u(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function m(){let[e,t]=r.useState(l);return r.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},87598:function(e,t,a){"use strict";a.d(t,{LL:function(){return d},Sv:function(){return f},X3:function(){return c},c9:function(){return u},kb:function(){return m},vO:function(){return l},yj:function(){return i}});var r=a(5978),s=a(1850),o=a(738),n=a(17293);let i=async e=>{let t=(0,o.Mq)(),a=(0,s.$C)(t,"us-central1"),r=(0,s.V1)(a,"createTelemedicineRoom");try{console.log("Chamando a Cloud Function 'createTelemedicineRoom' para o contrato: ".concat(e));let t=(await r({contractId:e})).data;if(t.success&&t.roomUrl)return console.log("Sala de telemedicina criada com sucesso:",t.roomUrl),t.roomUrl;throw Error("A Cloud Function n\xe3o retornou uma URL v\xe1lida.")}catch(e){throw console.error("Erro ao chamar a fun\xe7\xe3o createTelemedicineRoom:",e),Error("N\xe3o foi poss\xedvel criar a sala de telemedicina.")}},c=async e=>{let t=(0,o.Mq)(),a=(0,s.$C)(t,"us-central1"),r=(0,s.V1)(a,"generateContractPdf");try{let t=(await r({contractId:e})).data;if(t.success&&t.pdfUrl)return t.pdfUrl;throw Error("A Cloud Function n\xe3o retornou uma URL de PDF v\xe1lida.")}catch(e){throw console.error("Erro ao chamar a fun\xe7\xe3o generateContractPdf:",e),Error("N\xe3o foi poss\xedvel gerar o documento do contrato.")}},l=async e=>{let t=n.I8.currentUser;if(!t||!e||0===e.length)return[];try{let a=(0,r.hJ)(n.db,"contracts"),s=(0,r.IO)(a,(0,r.ar)("doctorId","==",t.uid),(0,r.ar)("status","in",e),(0,r.Xo)("createdAt","desc"));return(await (0,r.PL)(s)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("[getContractsForDoctor] Erro:",e),Error("Falha ao carregar os contratos do m\xe9dico.")}},d=async e=>{let t=n.I8.currentUser;if(!t||!e||0===e.length)return[];try{let a=(0,r.hJ)(n.db,"contracts"),s=(0,r.IO)(a,(0,r.ar)("hospitalId","==",t.uid),(0,r.ar)("status","in",e),(0,r.Xo)("createdAt","desc"));return(await (0,r.PL)(s)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("[getContractsForHospital] Erro:",e),Error("Falha ao carregar os contratos do hospital.")}},u=async e=>{if(!n.I8.currentUser)throw Error("Usu\xe1rio n\xe3o autenticado.");let t=(0,r.JU)(n.db,"contracts",e);await (0,r.i3)(n.db,async a=>{var s;let o=await a.get(t);if(!o.exists()||"PENDING_DOCTOR_SIGNATURE"!==o.data().status)throw Error("Este contrato n\xe3o est\xe1 mais dispon\xedvel para assinatura.");let i=o.data().timeSlotId;if(!i)throw Error("ID da disponibilidade original n\xe3o encontrado no contrato.");let c=(0,r.JU)(n.db,"doctorTimeSlots",i),l=await a.get(c);if(l.exists()&&(null===(s=l.data())||void 0===s?void 0:s.status)!=="AVAILABLE")throw Error("Esta disponibilidade n\xe3o est\xe1 mais livre. A vaga pode ter sido preenchida.");a.update(t,{status:"PENDING_HOSPITAL_SIGNATURE",doctorSignature:{signedAt:(0,r.Bt)()},updatedAt:(0,r.Bt)()}),a.update(c,{status:"BOOKED",relatedContractId:e,updatedAt:(0,r.Bt)()})})},m=async e=>{let t=n.I8.currentUser;if(!t)throw Error("Hospital n\xe3o autenticado.");await (0,r.i3)(n.db,async a=>{let s=(0,r.JU)(n.db,"contracts",e),o=await a.get(s);if(!o.exists()||"PENDING_HOSPITAL_SIGNATURE"!==o.data().status)throw Error("Este contrato n\xe3o est\xe1 mais aguardando sua assinatura.");let i=o.data(),c=(0,r.JU)(n.db,"shiftRequirements",i.shiftRequirementId),l=(0,r.JU)(n.db,"users",i.doctorId),d=await a.get(l);if(a.update(s,{status:"ACTIVE_SIGNED",hospitalSignature:{signedAt:(0,r.Bt)(),signedByUID:t.uid},updatedAt:(0,r.Bt)()}),a.update(c,{status:"CONFIRMED",updatedAt:(0,r.Bt)()}),d.exists()){let e=d.data(),s=(0,r.JU)((0,r.hJ)(n.db,"users",t.uid,"hospitalDoctors"),i.doctorId);a.set(s,{name:e.displayName||"Nome n\xe3o informado",crm:e.professionalCrm||"N\xe3o informado",email:e.email||"N\xe3o informado",phone:e.phone||"N\xe3o informado",specialties:e.specialties||[],status:"ACTIVE_PLATFORM",source:"PLATFORM",addedAt:(0,r.Bt)()},{merge:!0})}})},f=async(e,t)=>{if(!e)throw Error("ID do contrato \xe9 obrigat\xf3rio.");if(!t||""===t.trim())throw Error("O motivo do cancelamento \xe9 obrigat\xf3rio.");let a=(0,r.JU)(n.db,"contracts",e);await (0,r.r7)(a,{status:"CANCELLED",cancellationReason:t,updatedAt:(0,r.Bt)()})}},17293:function(e,t,a){"use strict";a.d(t,{I8:function(){return l},db:function(){return d},tO:function(){return u},wk:function(){return m}});var r=a(738),s=a(82148),o=a(5978),n=a(96485),i=a(1850);let c=(0,r.C6)().length?(0,r.Mq)():(0,r.ZF)({apiKey:"AIzaSyAyoX1YqAdqHuIvSoj0Yw_FYnhCBv-KfEA",authDomain:"fht-sistema.firebaseapp.com",projectId:"fht-sistema",storageBucket:"fht-sistema.appspot.com",messagingSenderId:"583837273524",appId:"1:583837273524:web:1583addfce581e61ac76e1",measurementId:"G-6FJ2H3G32N"}),l=(0,s.v0)(c),d=(0,o.ad)(c),u=(0,n.cF)(c),m=(0,i.$C)(c,"us-central1")},15822:function(e,t,a){"use strict";a.d(t,{v:function(){return o}});var r=a(96485),s=a(17293);let o=async(e,t,a)=>new Promise((o,n)=>{let i=(0,r.iH)(s.tO,t),c=(0,r.B0)(i,e);c.on("state_changed",t=>{let r=t.bytesTransferred/t.totalBytes*100;a&&a(r),console.log("[StorageService] Upload de ".concat(e.name," est\xe1 ").concat(r,"% done"))},e=>{console.error("[StorageService] Falha no upload:",e);let t="Erro desconhecido no upload do arquivo.";switch(e.code){case"storage/unauthorized":t="Permiss\xe3o negada. Verifique as regras do Storage.";break;case"storage/canceled":t="Upload cancelado.";break;default:t="Erro no upload: ".concat(e.message)}n(Error(t))},async()=>{try{let t=await (0,r.Jt)(c.snapshot.ref);console.log("[StorageService] Arquivo ".concat(e.name," dispon\xedvel em"),t),o(t)}catch(e){console.error("[StorageService] Erro ao obter URL de download:",e),n(Error("Falha ao obter URL de download ap\xf3s o upload."))}})})},94508:function(e,t,a){"use strict";a.d(t,{bx:function(){return c},cn:function(){return o},rl:function(){return i},xG:function(){return n}});var r=a(61994),s=a(53335);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}let n=e=>null==e||isNaN(e)?"R$ -":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),i=e=>null==e||isNaN(e)?"- %":"".concat(e.toFixed(1),"%"),c=e=>null==e||isNaN(e)?"- h":"".concat(e.toFixed(1)," h")}},function(e){e.O(0,[3609,9015,6137,9388,9733,793,6404,2971,2117,1744],function(){return e(e.s=12326)}),_N_E=e.O()}]);