(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[477],{52123:function(e,t,a){Promise.resolve().then(a.bind(a,97919))},97919:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return I}});var s=a(57437),r=a(2265),n=a(99376),i=a(17293),o=a(13491),l=a(5978),c=a(46413),d=a(35153),u=a(31623),f=a(92651),m=a(66070),p=a(62869),x=a(76818),h=a(95186),g=a(26815),v=a(12339),j=a(26110),N=a(6512),b=a(51817),y=a(29374),w=a(92369),S=a(95337),C=a(66140),k=a(48736),A=a(99397),E=a(18930);function I(){var e;let t=(0,n.useRouter)(),a=(0,n.useParams)(),{user:I}=(0,c.a)(),{toast:z}=(0,d.pm)(),T=a.consultaId,[_,R]=(0,r.useState)(null),[Z,D]=(0,r.useState)(null),[O,P]=(0,r.useState)(null),[V,M]=(0,r.useState)(!0),[U,Y]=(0,r.useState)(""),[F,L]=(0,r.useState)(""),[J,B]=(0,r.useState)([]),[G,Q]=(0,r.useState)(!1),[H,K]=(0,r.useState)(0),[X,q]=(0,r.useState)(""),[$,W]=(0,r.useState)(""),[ee,et]=(0,r.useState)(""),[ea,es]=(0,r.useState)(""),[er,en]=(0,r.useState)(!1),[ei,eo]=(0,r.useState)(!1),[el,ec]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!T)return;(async()=>{if(I&&!O){let e=await (0,f.Ts)();(null==e?void 0:e.role)==="doctor"&&P(e)}})();let e=(0,l.JU)(i.db,"consultations",T),a=(0,l.cf)(e,async e=>{if(e.exists()){let t={id:e.id,...e.data()};R(t),Y(t.clinicalEvolution||""),L(t.diagnosticHypothesis||""),B(t.prescriptions||[]),t.patientId&&!Z&&D(await (0,u.YR)(t.patientId))}else console.error("Consulta n\xe3o encontrada."),z({title:"Erro",description:"Consulta n\xe3o encontrada.",variant:"destructive"}),t.push("/dashboard/fila");M(!1)});return()=>a()},[T,I,O,Z,t,z]);let ed=async()=>{en(!0);try{let e=(0,l.JU)(i.db,"consultations",T);await (0,l.r7)(e,{clinicalEvolution:U,diagnosticHypothesis:F,prescriptions:J,updatedAt:(0,l.Bt)()}),z({title:"Rascunho Salvo!",description:"As informa\xe7\xf5es foram salvas com sucesso."})}catch(e){z({title:"Erro",description:"N\xe3o foi poss\xedvel salvar o rascunho.",variant:"destructive"})}finally{en(!1)}},eu=async()=>{eo(!0);try{let e=(0,l.JU)(i.db,"consultations",T);await (0,l.r7)(e,{clinicalEvolution:U,diagnosticHypothesis:F,prescriptions:J,status:"FINALIZADO",updatedAt:(0,l.Bt)()}),z({title:"Atendimento Finalizado!",description:"A consulta foi conclu\xedda e registrada.",className:"bg-green-600 text-white"}),t.push("/dashboard/fila")}catch(e){z({title:"Erro",description:"N\xe3o foi poss\xedvel finalizar o atendimento.",variant:"destructive"})}finally{eo(!1)}},ef=e=>{B(J.filter((t,a)=>a!==e))},em=async e=>{if(_&&Z&&O){ec(!0);try{let t;if("prescription"===e){if(0===J.length){z({title:"Prescri\xe7\xe3o Vazia",description:"Adicione pelo menos um medicamento.",variant:"destructive"});return}let e=(0,o.V1)(i.wk,"generatePrescriptionPdf");t=await e({consultationId:T,patientName:Z.name,doctorName:O.displayName,doctorCrm:O.professionalCrm||"CRM n\xe3o informado",medications:J})}else{let e=(0,o.V1)(i.wk,"generateDocumentPdf");t=await e({type:"medicalCertificate",consultationId:T,patientName:Z.name,doctorName:O.displayName,doctorCrm:O.professionalCrm||"CRM n\xe3o informado",details:{daysOff:H,cid:X}}),Q(!1)}let a=t.data.pdfUrl;a&&window.open(a,"_blank")}catch(e){z({title:"Erro ao Gerar PDF",description:"N\xe3o foi poss\xedvel gerar o documento.",variant:"destructive"})}finally{ec(!1)}}};return!V&&_&&Z?(0,s.jsxs)("div",{className:"container mx-auto p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold",children:["Atendimento - ",Z.name]}),(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Consulta de ",_.specialty]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(p.z,{variant:"outline",onClick:ed,disabled:er,children:[er?(0,s.jsx)(b.Z,{className:"mr-2 h-4 w-4 animate-spin"}):null," Salvar Rascunho"]}),(0,s.jsxs)(p.z,{onClick:eu,disabled:ei,className:"bg-green-600 hover:bg-green-700",children:[ei?(0,s.jsx)(b.Z,{className:"mr-2 h-4 w-4 animate-spin"}):null," Finalizar Atendimento"]})]})]}),(0,s.jsx)(N.Z,{}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,s.jsxs)(m.Zb,{children:[(0,s.jsx)(m.Ol,{children:(0,s.jsxs)(m.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(y.Z,{})," Sala de Telemedicina"]})}),(0,s.jsx)(m.aY,{className:"flex flex-col gap-3",children:_.telemedicineLink?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.z,{asChild:!0,size:"lg",children:(0,s.jsx)("a",{href:_.telemedicineLink,target:"_blank",rel:"noopener noreferrer",children:"Entrar na Videochamada"})}),(0,s.jsx)(p.z,{variant:"secondary",onClick:()=>navigator.clipboard.writeText(_.telemedicineLink||""),children:"Copiar Link para Paciente"})]}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Link da sala ainda n\xe3o gerado."})})]}),(0,s.jsxs)(m.Zb,{children:[(0,s.jsx)(m.Ol,{children:(0,s.jsxs)(m.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(w.Z,{})," Informa\xe7\xf5es do Paciente"]})}),(0,s.jsxs)(m.aY,{className:"text-sm space-y-2",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Nome:"})," ",Z.name]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"CPF:"})," ",Z.cpf||"N\xe3o informado"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Nascimento:"})," ",(null===(e=Z.dateOfBirth)||void 0===e?void 0:e.toDate().toLocaleDateString("pt-BR"))||"N\xe3o informado"]}),(0,s.jsx)("p",{className:"font-medium pt-2",children:(0,s.jsx)("strong",{children:"Queixa Principal:"})}),(0,s.jsxs)("p",{className:"italic text-muted-foreground",children:['"',_.chiefComplaint,'"']})]})]})]}),(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsxs)(v.mQ,{defaultValue:"evolution",children:[(0,s.jsxs)(v.dr,{className:"grid w-full grid-cols-3",children:[(0,s.jsxs)(v.SP,{value:"evolution",children:[(0,s.jsx)(S.Z,{className:"mr-2 h-4 w-4"}),"Evolu\xe7\xe3o"]}),(0,s.jsxs)(v.SP,{value:"prescription",children:[(0,s.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),"Prescri\xe7\xe3o"]}),(0,s.jsxs)(v.SP,{value:"documents",children:[(0,s.jsx)(k.Z,{className:"mr-2 h-4 w-4"}),"Documentos"]})]}),(0,s.jsx)(v.nU,{value:"evolution",className:"mt-4",children:(0,s.jsxs)(m.Zb,{children:[(0,s.jsx)(m.Ol,{children:(0,s.jsx)(m.ll,{children:"Anamnese e Evolu\xe7\xe3o Cl\xednica"})}),(0,s.jsx)(m.aY,{children:(0,s.jsx)(x.g,{placeholder:"Descreva a evolu\xe7\xe3o do paciente, exame f\xedsico, etc.",rows:15,value:U,onChange:e=>Y(e.target.value)})})]})}),(0,s.jsx)(v.nU,{value:"prescription",className:"mt-4",children:(0,s.jsxs)(m.Zb,{children:[(0,s.jsx)(m.Ol,{children:(0,s.jsx)(m.ll,{children:"Prescri\xe7\xe3o M\xe9dica"})}),(0,s.jsxs)(m.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-4 border rounded-lg space-y-3",children:[(0,s.jsx)("h4",{className:"font-semibold",children:"Adicionar Medicamento"}),(0,s.jsx)(h.I,{placeholder:"Nome do Medicamento",value:$,onChange:e=>W(e.target.value)}),(0,s.jsx)(h.I,{placeholder:"Dosagem (ex: 500mg)",value:ee,onChange:e=>et(e.target.value)}),(0,s.jsx)(x.g,{placeholder:"Instru\xe7\xf5es (ex: 1 comprimido a cada 8 horas por 7 dias)",value:ea,onChange:e=>es(e.target.value),rows:2}),(0,s.jsxs)(p.z,{onClick:()=>{if(!$||!ee){z({title:"Campos da Prescri\xe7\xe3o Vazios",description:"Preencha pelo menos o nome e a dosagem.",variant:"destructive"});return}B([...J,{name:$,dosage:ee,instructions:ea}]),W(""),et(""),es("")},size:"sm",children:[(0,s.jsx)(A.Z,{className:"mr-2 h-4 w-4"}),"Adicionar"]})]}),(0,s.jsx)(N.Z,{}),(0,s.jsxs)("div",{children:[J.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 border-b",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"font-semibold",children:[e.name," - ",e.dosage]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.instructions})]}),(0,s.jsx)(p.z,{variant:"ghost",size:"icon",onClick:()=>ef(t),children:(0,s.jsx)(E.Z,{className:"h-4 w-4 text-red-500"})})]},t)),0===J.length&&(0,s.jsx)("p",{className:"text-sm text-center text-muted-foreground py-4",children:"Nenhum medicamento adicionado."})]}),(0,s.jsxs)(p.z,{className:"w-full",onClick:()=>em("prescription"),disabled:el||0===J.length,children:[el?(0,s.jsx)(b.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(k.Z,{className:"mr-2 h-4 w-4"})," Gerar PDF da Prescri\xe7\xe3o"]})]})]})}),(0,s.jsx)(v.nU,{value:"documents",className:"mt-4",children:(0,s.jsxs)(m.Zb,{children:[(0,s.jsx)(m.Ol,{children:(0,s.jsx)(m.ll,{children:"Emiss\xe3o de Documentos"})}),(0,s.jsx)(m.aY,{className:"flex flex-col gap-4",children:(0,s.jsxs)(p.z,{onClick:()=>Q(!0),disabled:el,children:[(0,s.jsx)(k.Z,{className:"mr-2 h-4 w-4"})," Gerar Atestado M\xe9dico"]})})]})})]})})]}),(0,s.jsx)(j.Vq,{open:G,onOpenChange:Q,children:(0,s.jsxs)(j.cZ,{children:[(0,s.jsxs)(j.fK,{children:[(0,s.jsx)(j.$N,{children:"Gerar Atestado M\xe9dico"}),(0,s.jsx)(j.Be,{children:"Preencha as informa\xe7\xf5es para o atestado de afastamento."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)(g._,{htmlFor:"days-off",children:"Dias de Afastamento"}),(0,s.jsx)(h.I,{id:"days-off",type:"number",value:H,onChange:e=>K(parseInt(e.target.value,10)||0)})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)(g._,{htmlFor:"cid",children:"CID (Opcional)"}),(0,s.jsx)(h.I,{id:"cid",value:X,onChange:e=>q(e.target.value),placeholder:"Ex: A09"})]})]}),(0,s.jsxs)(j.cN,{children:[(0,s.jsx)(p.z,{variant:"outline",onClick:()=>Q(!1),children:"Cancelar"}),(0,s.jsxs)(p.z,{onClick:()=>em("certificate"),disabled:el,children:[el&&(0,s.jsx)(b.Z,{className:"mr-2 h-4 w-4 animate-spin"})," Gerar Atestado"]})]})]})})]}):(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsx)(b.Z,{className:"h-12 w-12 animate-spin text-blue-600"})})}},62869:function(e,t,a){"use strict";a.d(t,{d:function(){return l},z:function(){return c}});var s=a(57437),r=a(2265),n=a(37053),i=a(90535),o=a(94508);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:a,variant:r,size:i,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,s.jsx)(u,{className:(0,o.cn)(l({variant:r,size:i,className:a})),ref:t,...d})});c.displayName="Button"},66070:function(e,t,a){"use strict";a.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var s=a(57437),r=a(2265),n=a(94508);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});i.displayName="Card";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...r})});o.displayName="CardHeader";let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});l.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...r})});d.displayName="CardContent";let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...r})});u.displayName="CardFooter"},26110:function(e,t,a){"use strict";a.d(t,{$N:function(){return h},Be:function(){return g},GG:function(){return u},Vq:function(){return l},cN:function(){return x},cZ:function(){return m},fK:function(){return p},hg:function(){return c}});var s=a(57437),r=a(2265),n=a(49027),i=a(32489),o=a(94508);let l=n.fC,c=n.xz,d=n.h_,u=n.x8,f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.aV,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});f.displayName=n.aV.displayName;let m=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(d,{children:[(0,s.jsx)(f,{}),(0,s.jsxs)(n.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l,children:[r,(0,s.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=n.VY.displayName;let p=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};p.displayName="DialogHeader";let x=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};x.displayName="DialogFooter";let h=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});h.displayName=n.Dx.displayName;let g=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...r})});g.displayName=n.dk.displayName},95186:function(e,t,a){"use strict";a.d(t,{I:function(){return i}});var s=a(57437),r=a(2265),n=a(94508);let i=r.forwardRef((e,t)=>{let{className:a,type:r,...i}=e;return(0,s.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...i})});i.displayName="Input"},26815:function(e,t,a){"use strict";a.d(t,{_:function(){return c}});var s=a(57437),r=a(2265),n=a(6394),i=a(90535),o=a(94508);let l=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.f,{ref:t,className:(0,o.cn)(l(),a),...r})});c.displayName=n.f.displayName},6512:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var s=a(57437),r=a(2265),n=a(55156),i=a(94508);let o=r.forwardRef((e,t)=>{let{className:a,orientation:r="horizontal",decorative:o=!0,...l}=e;return(0,s.jsx)(n.f,{ref:t,decorative:o,orientation:r,className:(0,i.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",a),...l})});o.displayName=n.f.displayName},12339:function(e,t,a){"use strict";a.d(t,{SP:function(){return c},dr:function(){return l},mQ:function(){return o},nU:function(){return d}});var s=a(57437),r=a(2265),n=a(20271),i=a(94508);let o=n.fC,l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.aV,{ref:t,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});l.displayName=n.aV.displayName;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.xz,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});c.displayName=n.xz.displayName;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.VY,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});d.displayName=n.VY.displayName},76818:function(e,t,a){"use strict";a.d(t,{g:function(){return i}});var s=a(57437),r=a(2265),n=a(94508);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});i.displayName="Textarea"},35153:function(e,t,a){"use strict";a.d(t,{pm:function(){return f}});var s=a(2265);let r=0,n=new Map,i=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=o(c,e),l.forEach(e=>{e(c)})}function u(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function f(){let[e,t]=s.useState(c);return s.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},31623:function(e,t,a){"use strict";a.d(t,{E8:function(){return c},YR:function(){return u},Yn:function(){return l},Zw:function(){return d},bS:function(){return i},hK:function(){return n},xG:function(){return o}});var s=a(5978),r=a(17293);let n=async e=>{try{return(await (0,s.ET)((0,s.hJ)(r.db,"patients"),{...e,name_lowercase:e.name.toLowerCase(),createdAt:(0,s.Bt)()})).id}catch(e){throw console.error("Erro ao cadastrar paciente:",e),Error("N\xe3o foi poss\xedvel cadastrar o novo paciente.")}},i=async(e,t)=>{if(e.length<2)return[];try{let a=(0,s.hJ)(r.db,"patients"),n=e.toLowerCase(),i=(0,s.IO)(a,(0,s.ar)("unitId","==",t),(0,s.Xo)("name_lowercase"),(0,s.ar)("name_lowercase",">=",n),(0,s.ar)("name_lowercase","<=",n+""),(0,s.b9)(10));return(await (0,s.PL)(i)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Erro na busca por pacientes:",e),Error("N\xe3o foi poss\xedvel realizar a busca por pacientes.")}},o=async(e,t,a,n)=>{try{let i=(0,s.hJ)(r.db,"serviceQueue"),o=new Date;o.setHours(0,0,0,0);let l=(0,s.IO)(i,(0,s.ar)("unitId","==",t),(0,s.ar)("createdAt",">=",o)),c=await (0,s.PL)(l),d={ticketNumber:"".concat("Telemedicina"===n?"T":"A").concat((c.size+1).toString().padStart(3,"0")),patientName:e.name,patientId:e.id,status:"Aguardando Triagem",unitId:t,hospitalName:a,type:n,createdAt:(0,s.Bt)()};return(await (0,s.ET)(i,d)).id}catch(e){throw console.error("Erro ao adicionar paciente \xe0 fila:",e),Error("N\xe3o foi poss\xedvel adicionar o paciente \xe0 fila de atendimento.")}},l=(e,t,a,n)=>{let i=(0,s.IO)((0,s.hJ)(r.db,"serviceQueue"),(0,s.ar)("unitId","==",e),(0,s.ar)("status","==",t),(0,s.ar)("type","==",a),(0,s.Xo)("createdAt","asc"));return(0,s.cf)(i,e=>{n(e.docs.map(e=>({id:e.id,...e.data()})))},e=>{console.error("[PatientService] Erro ao escutar a fila de atendimento:",e),n([])})},c=async(e,t)=>{try{await (0,s.r7)((0,s.JU)(r.db,"serviceQueue",e),{status:"Em Triagem",nurseId:t})}catch(e){throw Error("N\xe3o foi poss\xedvel chamar o paciente para a triagem.")}},d=async(e,t)=>{try{await (0,s.r7)((0,s.JU)(r.db,"serviceQueue",e),{triageData:t,status:"Aguardando Atendimento"})}catch(e){throw Error("N\xe3o foi poss\xedvel finalizar a triagem.")}},u=async e=>{if(!e)return null;let t=await (0,s.QT)((0,s.JU)(r.db,"patients",e));return t.exists()?{id:t.id,...t.data()}:null}}},function(e){e.O(0,[4358,9990,6137,9084,9733,6838,4517,7446,3073,2971,2117,1744],function(){return e(e.s=52123)}),_N_E=e.O()}]);