(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2749],{54816:function(e,t,a){Promise.resolve().then(a.bind(a,66308))},66308:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return B}});var r=a(57437),s=a(2265),o=a(99376),n=a(44667),i=a(31209),l=a(87598),c=a(5978),d=a(17293);let u=async e=>{if(!e)return null;let t=(0,c.hJ)(d.db,"consultations"),a=(0,c.IO)(t,(0,c.ar)("contractId","==",e),(0,c.b9)(1));try{let t=await (0,c.PL)(a);if(t.empty)return console.warn("[getConsultationByContractId] Nenhuma consulta encontrada para o contractId: ".concat(e)),null;let r=t.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("[getConsultationByContractId] Erro ao buscar consulta:",e),Error("Falha ao carregar os dados da consulta.")}},m=async(e,t)=>{if(!e)throw Error("ID da consulta \xe9 obrigat\xf3rio.");let a=(0,c.JU)(d.db,"consultations",e);try{await (0,c.pl)(a,{clinicalEvolution:t.clinicalEvolution,diagnosticHypothesis:t.diagnosticHypothesis,status:"IN_PROGRESS"},{merge:!0})}catch(e){throw console.error("[saveConsultationDetails] Erro ao salvar detalhes da consulta:",e),Error("N\xe3o foi poss\xedvel salvar os dados do prontu\xe1rio.")}};var h=a(13491),f=a(738);let x=async e=>{if(0===e.medications.length)throw Error("A receita deve conter pelo menos um medicamento.");let t=(0,f.Mq)(),a=(0,h.$C)(t,"us-central1"),r=(0,h.V1)(a,"generatePrescriptionPdf");try{console.log("Chamando a Cloud Function 'generatePrescriptionPdf'...");let t=(await r(e)).data;if(t.success)return console.log("Receita gerada com sucesso:",t),t;throw Error("A Cloud Function retornou um erro ao gerar a receita.")}catch(e){throw console.error("Erro ao chamar a fun\xe7\xe3o generatePrescriptionPdf:",e),Error("N\xe3o foi poss\xedvel gerar a receita em PDF.")}};var g=a(92651),p=a(92369),v=a(48662),j=a(60730),y=a(29374),N=a(88178),b=a(87133),w=a(18930),E=a(26937),C=a(51817),A=a(83229),P=a(76865),I=a(62869),S=a(46413),R=a(76818),U=a(26815),k=a(66070),D=a(12339),_=a(35153),z=a(26110),O=a(95186);let F=e=>{let{id:t}=e,a=(0,n.aV)(t),o=(0,s.useRef)(null),i=null==a?void 0:a.tracks.video.persistentTrack;return(0,s.useEffect)(()=>{o.current&&i&&(o.current.srcObject=new MediaStream([i]))},[i]),(0,r.jsxs)("div",{className:"relative aspect-video bg-gray-800 rounded-lg overflow-hidden shadow-lg",children:[(0,r.jsx)("video",{autoPlay:!0,muted:null==a?void 0:a.local,playsInline:!0,ref:o,className:"w-full h-full object-cover"}),!i&&(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 text-gray-400",children:[(0,r.jsx)(p.Z,{className:"w-16 h-16"}),(0,r.jsx)("p",{className:"font-bold",children:(null==a?void 0:a.user_name)||"Participante"}),(0,r.jsx)("p",{className:"text-xs",children:"C\xe2mera desligada"})]})}),(0,r.jsx)("div",{className:"absolute bottom-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded",children:(null==a?void 0:a.local)?"Voc\xea":(null==a?void 0:a.user_name)||"Participante"})]})},L=e=>{let{callObject:t}=e,a=(0,n.j1)(),s=(0,o.useRouter)();return t?((0,n.VU)("left-meeting",()=>{s.push("/dashboard/contracts")}),(0,r.jsxs)("div",{className:"flex justify-center items-center gap-3 p-4 bg-gray-800/80 backdrop-blur-sm border-t border-gray-700 rounded-t-xl",children:[(0,r.jsx)(I.z,{onClick:()=>t.setLocalAudio(!(null==a?void 0:a.audio)),variant:"outline",size:"icon",className:"bg-gray-700 hover:bg-gray-600 border-gray-600 rounded-full h-12 w-12",children:(null==a?void 0:a.audio)?(0,r.jsx)(v.Z,{size:20}):(0,r.jsx)(j.Z,{size:20,className:"text-red-500"})}),(0,r.jsx)(I.z,{onClick:()=>t.setLocalVideo(!(null==a?void 0:a.video)),variant:"outline",size:"icon",className:"bg-gray-700 hover:bg-gray-600 border-gray-600 rounded-full h-12 w-12",children:(null==a?void 0:a.video)?(0,r.jsx)(y.Z,{size:20}):(0,r.jsx)(N.Z,{size:20,className:"text-red-500"})}),(0,r.jsx)(I.z,{onClick:()=>t.leave(),variant:"destructive",size:"icon",className:"rounded-full h-14 w-14",children:(0,r.jsx)(b.Z,{size:24})})]})):null},T=e=>{let{consultation:t,doctorName:a,doctorCrm:o,onPrescriptionGenerated:n}=e,{toast:i}=(0,_.pm)(),[l,c]=(0,s.useState)([{name:"",dosage:"",instructions:""}]),[d,u]=(0,s.useState)(!1),m=(e,t,a)=>{let r=[...l];r[e][t]=a,c(r)},h=e=>{l.length<=1||c(l.filter((t,a)=>a!==e))},f=async e=>{e.preventDefault(),u(!0);try{let e=l.filter(e=>""!==e.name.trim()&&""!==e.dosage.trim()&&""!==e.instructions.trim());if(0===e.length){i({title:"Nenhum medicamento v\xe1lido",description:"Preencha todos os campos do medicamento.",variant:"destructive"});return}await x({consultationId:t.id,patientName:t.patientName,doctorName:a,doctorCrm:o,medications:e}),i({title:"Sucesso!",description:"Receita gerada e salva."}),n()}catch(e){i({title:"Erro ao Gerar Receita",description:e.message,variant:"destructive"})}finally{u(!1)}};return(0,r.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,r.jsx)("div",{className:"max-h-[50vh] overflow-y-auto pr-4 space-y-4",children:l.map((e,t)=>(0,r.jsxs)("div",{className:"p-4 border rounded-lg space-y-2 relative bg-gray-900/50",children:[l.length>1&&(0,r.jsx)(I.z,{type:"button",variant:"ghost",size:"icon",className:"absolute top-1 right-1 h-6 w-6",onClick:()=>h(t),children:(0,r.jsx)(w.Z,{className:"h-4 w-4 text-red-500"})}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(U._,{htmlFor:"med-name-".concat(t),children:"Medicamento"}),(0,r.jsx)(O.I,{id:"med-name-".concat(t),value:e.name,onChange:e=>m(t,"name",e.target.value),placeholder:"Ex: Amoxicilina 500mg",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(U._,{htmlFor:"med-dosage-".concat(t),children:"Dose/Quantidade"}),(0,r.jsx)(O.I,{id:"med-dosage-".concat(t),value:e.dosage,onChange:e=>m(t,"dosage",e.target.value),placeholder:"Ex: 1 comprimido",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(U._,{htmlFor:"med-instructions-".concat(t),children:"Instru\xe7\xf5es"}),(0,r.jsx)(R.g,{id:"med-instructions-".concat(t),value:e.instructions,onChange:e=>m(t,"instructions",e.target.value),placeholder:"Ex: Tomar a cada 8 horas por 7 dias",required:!0})]})]},t))}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t",children:[(0,r.jsxs)(I.z,{type:"button",variant:"outline",onClick:()=>{c([...l,{name:"",dosage:"",instructions:""}])},children:[(0,r.jsx)(E.Z,{className:"mr-2 h-4 w-4"})," Adicionar Medicamento"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(z.GG,{asChild:!0,children:(0,r.jsx)(I.z,{type:"button",variant:"secondary",children:"Cancelar"})}),(0,r.jsxs)(I.z,{type:"submit",disabled:d,children:[d&&(0,r.jsx)(C.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Gerar Receita"]})]})]})]})},Z=e=>{let{consultation:t,userProfile:a}=e,{toast:o}=(0,_.pm)(),[n,i]=(0,s.useState)((null==t?void 0:t.clinicalEvolution)||""),[l,c]=(0,s.useState)((null==t?void 0:t.diagnosticHypothesis)||""),[d,u]=(0,s.useState)(!1),[h,f]=(0,s.useState)(!1),x=async()=>{if(t){u(!0);try{await m(t.id,{clinicalEvolution:n,diagnosticHypothesis:l}),o({title:"Sucesso!",description:"Prontu\xe1rio salvo."})}catch(e){o({title:"Erro ao Salvar",description:e.message,variant:"destructive"})}finally{u(!1)}}};return t?(0,r.jsxs)(k.Zb,{className:"h-full flex flex-col bg-gray-800 border-gray-700 text-white",children:[(0,r.jsx)(k.Ol,{children:(0,r.jsx)(k.ll,{className:"text-lg",children:"Prontu\xe1rio Eletr\xf4nico"})}),(0,r.jsxs)(k.aY,{className:"flex-grow flex flex-col gap-4 overflow-y-auto",children:[(0,r.jsxs)(D.mQ,{defaultValue:"patient-data",className:"flex-grow flex flex-col",children:[(0,r.jsxs)(D.dr,{className:"grid w-full grid-cols-3 bg-gray-900",children:[(0,r.jsx)(D.SP,{value:"patient-data",children:"Paciente"}),(0,r.jsx)(D.SP,{value:"medical-record",children:"Atendimento"}),(0,r.jsx)(D.SP,{value:"documents",children:"Documentos"})]}),(0,r.jsxs)(D.nU,{value:"patient-data",className:"text-sm space-y-3 mt-4 flex-grow",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{className:"text-gray-400",children:"Nome"}),(0,r.jsx)("p",{children:t.patientName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{className:"text-gray-400",children:"Queixa Principal"}),(0,r.jsx)("p",{children:t.chiefComplaint})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{className:"text-gray-400",children:"Hist\xf3rico Resumido"}),(0,r.jsx)("p",{className:"whitespace-pre-wrap",children:t.medicalHistorySummary||"Nenhum hist\xf3rico informado."})]})]}),(0,r.jsxs)(D.nU,{value:"medical-record",className:"flex-grow flex flex-col gap-4 mt-4",children:[(0,r.jsxs)("div",{className:"space-y-1.5 flex flex-col flex-grow",children:[(0,r.jsx)(U._,{htmlFor:"evolution",children:"Evolu\xe7\xe3o Cl\xednica"}),(0,r.jsx)(R.g,{id:"evolution",value:n,onChange:e=>i(e.target.value),className:"bg-gray-900 border-gray-600 text-white min-h-[150px] flex-grow"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(U._,{htmlFor:"hypothesis",children:"Hip\xf3tese Diagn\xf3stica"}),(0,r.jsx)(R.g,{id:"hypothesis",value:l,onChange:e=>c(e.target.value),className:"bg-gray-900 border-gray-600 text-white"})]})]}),(0,r.jsx)(D.nU,{value:"documents",className:"mt-4 space-y-4",children:(0,r.jsxs)(z.Vq,{open:h,onOpenChange:f,children:[(0,r.jsx)(z.hg,{asChild:!0,children:(0,r.jsx)(I.z,{variant:"outline",className:"w-full bg-gray-700 hover:bg-gray-600 border-gray-600",children:"Gerar Receita"})}),(0,r.jsxs)(z.cZ,{className:"sm:max-w-2xl",children:[(0,r.jsxs)(z.fK,{children:[(0,r.jsx)(z.$N,{children:"Nova Receita M\xe9dica"}),(0,r.jsx)(z.Be,{children:"Preencha os medicamentos e instru\xe7\xf5es para o paciente."})]}),t&&a?(0,r.jsx)(T,{consultation:t,doctorName:a.displayName||"Nome n\xe3o encontrado",doctorCrm:a.professionalCrm||"CRM n\xe3o encontrado",onPrescriptionGenerated:()=>{f(!1)}}):(0,r.jsx)("div",{className:"py-8 text-center",children:"A carregar dados do m\xe9dico..."})]})]})})]}),(0,r.jsx)("div",{className:"mt-auto pt-4",children:(0,r.jsxs)(I.z,{onClick:x,disabled:d,className:"w-full",children:[d?(0,r.jsx)(C.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(A.Z,{className:"mr-2 h-4 w-4"}),"Salvar Prontu\xe1rio"]})})]})]}):(0,r.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-4 text-sm text-center text-gray-400 bg-gray-800 rounded-lg border border-gray-700",children:[(0,r.jsx)(C.Z,{className:"h-6 w-6 animate-spin mb-4"}),"A carregar dados da consulta..."]})},V=e=>{let{callObject:t}=e,{user:a}=(0,S.a)(),i=(0,o.useRouter)(),c=(0,o.useParams)().contractId,[d,m]=(0,s.useState)(null),[h,f]=(0,s.useState)(null),[x,p]=(0,s.useState)(null),[v,j]=(0,s.useState)(!0),[y,N]=(0,s.useState)(null),b=(0,n.OV)();return((0,s.useEffect)(()=>{if(c&&t&&a)return(async()=>{try{let[e,r,s]=await Promise.all([(0,l.iD)(c),u(c),(0,g.Ts)()]);if(p(s),!e||e.doctorId!==a.uid){N("Contrato n\xe3o encontrado ou acesso n\xe3o permitido."),j(!1);return}if(!e.telemedicineLink){N("Link de telemedicina n\xe3o encontrado para este contrato."),j(!1);return}m(e),f(r),await t.join({url:e.telemedicineLink,userName:a.displayName||"M\xe9dico(a)"})}catch(e){N(e.message||"Falha ao carregar a sala de atendimento.")}finally{j(!1)}})(),()=>{null==t||t.leave()}},[c,t,a,i]),v)?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-900 text-white",children:[(0,r.jsx)(C.Z,{className:"h-12 w-12 animate-spin text-blue-400"}),(0,r.jsx)("p",{className:"mt-4 text-lg",children:"A carregar dados da consulta..."})]}):y?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-900 text-white p-4",children:[(0,r.jsx)(P.Z,{className:"h-12 w-12 text-red-400"}),(0,r.jsxs)("p",{className:"mt-4 text-lg text-center",children:["Erro: ",y]}),(0,r.jsx)(I.z,{onClick:()=>i.push("/dashboard/contracts"),className:"mt-4",children:"Voltar"})]}):(0,r.jsxs)("div",{className:"w-full h-screen bg-gray-900 text-white flex flex-col md:flex-row gap-4 p-4",children:[(0,r.jsx)("div",{className:"w-full md:w-1/3 h-full",children:(0,r.jsx)(Z,{consultation:h,userProfile:x})}),(0,r.jsxs)("div",{className:"w-full md:w-2/3 h-full flex flex-col gap-4",children:[(0,r.jsxs)("header",{className:"flex justify-between items-center flex-shrink-0",children:[(0,r.jsx)("h1",{className:"text-xl font-bold",children:"Atendimento Telemedicina"}),d&&(0,r.jsxs)("p",{className:"text-sm text-gray-400",children:["Contrato com: ",d.hospitalName]})]}),(0,r.jsx)("main",{className:"flex-grow grid grid-cols-1 place-content-center",children:b.map(e=>(0,r.jsx)(F,{id:e},e))}),(0,r.jsx)("footer",{className:"flex-shrink-0",children:(0,r.jsx)(L,{callObject:t})})]})]})};function B(){let[e,t]=(0,s.useState)(null);return((0,s.useEffect)(()=>{let e=i.ZP.createCallObject();return t(e),()=>{e.destroy()}},[]),e)?(0,r.jsx)(n.Eu,{callObject:e,children:(0,r.jsx)(V,{callObject:e})}):(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-900 text-white",children:[(0,r.jsx)(C.Z,{className:"h-12 w-12 animate-spin text-blue-400"}),(0,r.jsx)("p",{className:"mt-4 text-lg",children:"A inicializar a sala de v\xeddeo..."})]})}},46413:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return c},a:function(){return d}});var r=a(57437),s=a(2265),o=a(43301),n=a(17293),i=a(92651);let l=(0,s.createContext)(void 0),c=e=>{let{children:t}=e,[a,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(!0),[f,x]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{console.log("[AuthProvider] Subscribing to onAuthStateChanged (montagem do provider)");let e=(0,o.Aj)(n.I8,async e=>{if(console.log("[AuthProvider] onAuthStateChanged: User state changed. New Firebase user:",e?e.uid:null),c(e),e){x(!0);try{let e=await (0,i.Ts)();u(e),console.log("[AuthProvider] onAuthStateChanged: Profile fetched after user state change:",e)}catch(e){console.error("[AuthProvider] onAuthStateChanged: Error fetching profile:",e),u(null)}finally{x(!1)}}else u(null),x(!1);h(!1),console.log("[AuthProvider] onAuthStateChanged: Loading set to false.")});return()=>{console.log("[AuthProvider] Unsubscribing from onAuthStateChanged (desmontagem do provider)"),e()}},[]),console.log("[AuthProvider] Context values updated - User:",a?a.uid:null,"Loading:",m,"ProfileLoading:",f),(0,r.jsx)(l.Provider,{value:{user:a,userProfile:d,loading:m,profileLoading:f},children:t})},d=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},26110:function(e,t,a){"use strict";a.d(t,{$N:function(){return g},Be:function(){return p},GG:function(){return u},Vq:function(){return l},cN:function(){return x},cZ:function(){return h},fK:function(){return f},hg:function(){return c}});var r=a(57437),s=a(2265),o=a(49027),n=a(32489),i=a(94508);let l=o.fC,c=o.xz,d=o.h_,u=o.x8,m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});m.displayName=o.aV.displayName;let h=s.forwardRef((e,t)=>{let{className:a,children:s,...l}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(m,{}),(0,r.jsxs)(o.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l,children:[s,(0,r.jsxs)(o.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(n.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});h.displayName=o.VY.displayName;let f=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};f.displayName="DialogHeader";let x=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};x.displayName="DialogFooter";let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});g.displayName=o.Dx.displayName;let p=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})});p.displayName=o.dk.displayName},95186:function(e,t,a){"use strict";a.d(t,{I:function(){return n}});var r=a(57437),s=a(2265),o=a(94508);let n=s.forwardRef((e,t)=>{let{className:a,type:s,...n}=e;return(0,r.jsx)("input",{type:s,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});n.displayName="Input"},26815:function(e,t,a){"use strict";a.d(t,{_:function(){return c}});var r=a(57437),s=a(2265),o=a(6394),n=a(90535),i=a(94508);let l=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.f,{ref:t,className:(0,i.cn)(l(),a),...s})});c.displayName=o.f.displayName},76818:function(e,t,a){"use strict";a.d(t,{g:function(){return n}});var r=a(57437),s=a(2265),o=a(94508);let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...s})});n.displayName="Textarea"},87598:function(e,t,a){"use strict";a.d(t,{LL:function(){return u},Sv:function(){return f},X3:function(){return l},c9:function(){return m},iD:function(){return c},kb:function(){return h},vO:function(){return d},yj:function(){return i}});var r=a(5978),s=a(13491),o=a(738),n=a(17293);let i=async e=>{let t=(0,o.Mq)(),a=(0,s.$C)(t,"us-central1"),r=(0,s.V1)(a,"createTelemedicineRoom");try{console.log("Chamando a Cloud Function 'createTelemedicineRoom' para o contrato: ".concat(e));let t=(await r({contractId:e})).data;if(t.success&&t.roomUrl)return console.log("Sala de telemedicina criada com sucesso:",t.roomUrl),t.roomUrl;throw Error("A Cloud Function n\xe3o retornou uma URL v\xe1lida.")}catch(e){throw console.error("Erro ao chamar a fun\xe7\xe3o createTelemedicineRoom:",e),Error("N\xe3o foi poss\xedvel criar a sala de telemedicina.")}},l=async e=>{let t=(0,o.Mq)(),a=(0,s.$C)(t,"us-central1"),r=(0,s.V1)(a,"generateContractPdf");try{let t=(await r({contractId:e})).data;if(t.success&&t.pdfUrl)return t.pdfUrl;throw Error("A Cloud Function n\xe3o retornou uma URL de PDF v\xe1lida.")}catch(e){throw console.error("Erro ao chamar a fun\xe7\xe3o generateContractPdf:",e),Error("N\xe3o foi poss\xedvel gerar o documento do contrato.")}},c=async e=>{let t=(0,r.JU)(n.db,"contracts",e);try{let e=await (0,r.QT)(t);if(e.exists())return{id:e.id,...e.data()};return null}catch(t){throw console.error("[getContractById] Erro ao buscar contrato ".concat(e,":"),t),Error("Falha ao carregar os detalhes do contrato.")}},d=async e=>{let t=n.I8.currentUser;if(!t||!e||0===e.length)return[];try{let a=(0,r.hJ)(n.db,"contracts"),s=(0,r.IO)(a,(0,r.ar)("doctorId","==",t.uid),(0,r.ar)("status","in",e),(0,r.Xo)("createdAt","desc"));return(await (0,r.PL)(s)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("[getContractsForDoctor] Erro:",e),Error("Falha ao carregar os contratos do m\xe9dico.")}},u=async e=>{let t=n.I8.currentUser;if(!t||!e||0===e.length)return[];try{let a=(0,r.hJ)(n.db,"contracts"),s=(0,r.IO)(a,(0,r.ar)("hospitalId","==",t.uid),(0,r.ar)("status","in",e),(0,r.Xo)("createdAt","desc"));return(await (0,r.PL)(s)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("[getContractsForHospital] Erro:",e),Error("Falha ao carregar os contratos do hospital.")}},m=async e=>{if(!n.I8.currentUser)throw Error("Usu\xe1rio n\xe3o autenticado.");let t=(0,r.JU)(n.db,"contracts",e);await (0,r.i3)(n.db,async a=>{var s;let o=await a.get(t);if(!o.exists()||"PENDING_DOCTOR_SIGNATURE"!==o.data().status)throw Error("Este contrato n\xe3o est\xe1 mais dispon\xedvel para assinatura.");let i=o.data().timeSlotId;if(!i)throw Error("ID da disponibilidade original n\xe3o encontrado no contrato.");let l=(0,r.JU)(n.db,"doctorTimeSlots",i),c=await a.get(l);if(c.exists()&&(null===(s=c.data())||void 0===s?void 0:s.status)!=="AVAILABLE")throw Error("Esta disponibilidade n\xe3o est\xe1 mais livre. A vaga pode ter sido preenchida.");a.update(t,{status:"PENDING_HOSPITAL_SIGNATURE",doctorSignature:{signedAt:(0,r.Bt)()},updatedAt:(0,r.Bt)()}),a.update(l,{status:"BOOKED",relatedContractId:e,updatedAt:(0,r.Bt)()})})},h=async e=>{let t=n.I8.currentUser;if(!t)throw Error("Hospital n\xe3o autenticado.");await (0,r.i3)(n.db,async a=>{let s=(0,r.JU)(n.db,"contracts",e),o=await a.get(s);if(!o.exists()||"PENDING_HOSPITAL_SIGNATURE"!==o.data().status)throw Error("Este contrato n\xe3o est\xe1 mais aguardando sua assinatura.");let i=o.data(),l=(0,r.JU)(n.db,"shiftRequirements",i.shiftRequirementId),c=(0,r.JU)(n.db,"users",i.doctorId),d=await a.get(c);if(a.update(s,{status:"ACTIVE_SIGNED",hospitalSignature:{signedAt:(0,r.Bt)(),signedByUID:t.uid},updatedAt:(0,r.Bt)()}),a.update(l,{status:"CONFIRMED",updatedAt:(0,r.Bt)()}),d.exists()){let e=d.data(),s=(0,r.JU)((0,r.hJ)(n.db,"users",t.uid,"hospitalDoctors"),i.doctorId);a.set(s,{name:e.displayName||"Nome n\xe3o informado",crm:e.professionalCrm||"N\xe3o informado",email:e.email||"N\xe3o informado",phone:e.phone||"N\xe3o informado",specialties:e.specialties||[],status:"ACTIVE_PLATFORM",source:"PLATFORM",addedAt:(0,r.Bt)()},{merge:!0})}})},f=async(e,t)=>{if(!e)throw Error("ID do contrato \xe9 obrigat\xf3rio.");if(!t||""===t.trim())throw Error("O motivo do cancelamento \xe9 obrigat\xf3rio.");let a=(0,r.JU)(n.db,"contracts",e);await (0,r.r7)(a,{status:"CANCELLED",cancellationReason:t,updatedAt:(0,r.Bt)()})}}},function(e){e.O(0,[4358,9990,1878,6137,9084,1543,7877,8398,562,8621,2971,2117,1744],function(){return e(e.s=54816)}),_N_E=e.O()}]);