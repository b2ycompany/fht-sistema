"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{46413:function(e,t,a){a.d(t,{AuthProvider:function(){return l},a:function(){return c}});var r=a(57437),s=a(2265),o=a(43301),n=a(17293),i=a(92651);let d=(0,s.createContext)(void 0),l=e=>{let{children:t}=e,[a,l]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[m,f]=(0,s.useState)(!0),[h,x]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{console.log("[AuthProvider] Subscribing to onAuthStateChanged (montagem do provider)");let e=(0,o.Aj)(n.I8,async e=>{if(console.log("[AuthProvider] onAuthStateChanged: User state changed. New Firebase user:",e?e.uid:null),l(e),e){x(!0);try{let e=await (0,i.Ts)();u(e),console.log("[AuthProvider] onAuthStateChanged: Profile fetched after user state change:",e)}catch(e){console.error("[AuthProvider] onAuthStateChanged: Error fetching profile:",e),u(null)}finally{x(!1)}}else u(null),x(!1);f(!1),console.log("[AuthProvider] onAuthStateChanged: Loading set to false.")});return()=>{console.log("[AuthProvider] Unsubscribing from onAuthStateChanged (desmontagem do provider)"),e()}},[]),console.log("[AuthProvider] Context values updated - User:",a?a.uid:null,"Loading:",m,"ProfileLoading:",h),(0,r.jsx)(d.Provider,{value:{user:a,userProfile:c,loading:m,profileLoading:h},children:t})},c=()=>{let e=(0,s.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},67643:function(e,t,a){a.d(t,{C:function(){return A}});var r=a(57437),s=a(2265),o=a(62869),n=a(66070),i=a(35153),d=a(99376),l=a(51817),c=a(76865),u=a(69076),m=a(83774),f=a(88501),h=a(91723),x=a(95252),p=a(15868),g=a(29374),N=a(87598),v=a(94508),b=a(37099),y=a(35974);let w=s.memo(e=>{let{message:t="Carregando..."}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-10 min-h-[150px] w-full",children:[(0,r.jsx)(l.Z,{className:"h-8 w-8 animate-spin text-blue-600"}),(0,r.jsx)("p",{className:"mt-3 text-sm text-gray-600",children:t})]})}),j=s.memo(e=>{let{message:t,onRetry:a}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-10 min-h-[150px] w-full text-center text-sm text-red-600 bg-red-50/70 rounded-md border border-dashed border-red-300",children:[(0,r.jsx)(c.Z,{className:"w-12 h-12 text-red-400 mb-4"}),(0,r.jsx)("p",{className:"text-base font-semibold text-red-700 mb-1",children:"Oops!"}),(0,r.jsx)("p",{children:t||"N\xe3o foi poss\xedvel carregar."}),a&&(0,r.jsxs)(o.z,{variant:"destructive",size:"sm",onClick:a,className:"mt-4",children:[(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Tentar Novamente"]})]})}),A=e=>{let{contract:t,onSign:a,userType:c}=e,[u,A]=(0,s.useState)(!1),[E,C]=(0,s.useState)(!1),[I,S]=(0,s.useState)(t.contractPdfUrl||""),[D,R]=(0,s.useState)(!1),{toast:P}=(0,i.pm)(),T=(0,d.useRouter)(),U=async()=>{if(R(!0),!I&&"hospital"!==c){A(!0),P({title:"A gerar documento...",description:"Por favor, aguarde."});try{let e=await (0,N.X3)(t.id);S(e)}catch(e){P({title:"Erro ao Gerar Contrato",description:e.message,variant:"destructive"})}finally{A(!1)}}},L=async()=>{A(!0);try{await a(t.id),R(!1)}catch(e){P({title:"Erro ao Assinar",description:e.message,variant:"destructive"})}finally{A(!1)}},_=async()=>{C(!0),P({title:"Preparando a sala de atendimento...",description:"Aguarde um momento."});try{t.telemedicineLink||await (0,N.yj)(t.id),T.push("/telemedicine/".concat(t.id))}catch(e){P({title:"Erro ao Iniciar Atendimento",description:e.message,variant:"destructive"}),C(!1)}},O=Array.isArray(t.shiftDates)?t.shiftDates.map(e=>e.toDate().toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})).join(", "):"Datas n\xe3o dispon\xedveis",G=(e=>{switch(e){case"PENDING_DOCTOR_SIGNATURE":return{variant:"secondary",className:"bg-amber-100 text-amber-800 border-amber-300"};case"PENDING_HOSPITAL_SIGNATURE":return{variant:"secondary",className:"bg-sky-100 text-sky-800 border-sky-300"};case"ACTIVE_SIGNED":return{variant:"default",className:"bg-green-100 text-green-800 border-green-300"};case"COMPLETED":return{variant:"default",className:"bg-slate-200 text-slate-800 border-slate-300"};case"CANCELLED":return{variant:"destructive",className:""};default:return{variant:"outline",className:""}}})(t.status),k="doctor"===c?t.doctorRate:t.hospitalRate,F="doctor"===c?"Contrato com: ".concat(t.hospitalName):"Contrato com Dr(a). ".concat(t.doctorName),Z="doctor"===c&&"PENDING_DOCTOR_SIGNATURE"===t.status||"hospital"===c&&"PENDING_HOSPITAL_SIGNATURE"===t.status,B="doctor"===c&&"ACTIVE_SIGNED"===t.status&&"Telemedicina"===t.serviceType;return(0,r.jsxs)(n.Zb,{className:"shadow-sm hover:shadow-md transition-shadow duration-300 ease-in-out",children:[(0,r.jsx)(n.Ol,{className:"pb-3",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(n.ll,{className:"text-base mb-1",children:F}),(0,r.jsxs)(n.SZ,{className:"text-xs flex items-center",children:[(0,r.jsx)(m.Z,{className:"inline h-3 w-3 mr-1"}),t.locationCity,", ",t.locationState]})]}),(0,r.jsx)(y.C,{variant:G.variant,className:"capitalize text-xs",children:t.status.replace(/_/g," ").toLowerCase()})]})}),(0,r.jsxs)(n.aY,{className:"text-sm pt-2 pb-3 border-y grid grid-cols-1 sm:grid-cols-3 gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4 mr-2 text-gray-500"}),(0,r.jsx)("span",{className:"font-medium",children:O})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 mr-2 text-gray-500"}),(0,r.jsxs)("span",{className:"font-medium",children:[t.startTime," - ",t.endTime]})]}),(0,r.jsxs)("div",{className:"flex items-center font-semibold ".concat("doctor"===c?"text-green-700":"text-red-700"),children:[(0,r.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),(0,r.jsxs)("span",{className:"font-medium",children:[(0,v.xG)(k),"/hora"]})]})]}),(Z||B)&&(0,r.jsxs)(n.eW,{className:"flex justify-end items-center pt-3 pb-3",children:[Z&&(0,r.jsxs)(b.aR,{open:D,onOpenChange:R,children:[(0,r.jsx)(b.vW,{asChild:!0,children:(0,r.jsxs)(o.z,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:U,disabled:u,children:[u&&!I?(0,r.jsx)(l.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"Rever e Assinar"]})}),(0,r.jsxs)(b._T,{className:"max-w-4xl h-[90vh] flex flex-col",children:[(0,r.jsx)(b.fY,{children:(0,r.jsx)(b.f$,{children:"Revis\xe3o e Assinatura do Contrato"})}),(0,r.jsx)("div",{className:"flex-grow my-4 border rounded-md overflow-hidden bg-gray-200",children:u&&!I?(0,r.jsx)(w,{message:"A gerar documento..."}):I?(0,r.jsx)("iframe",{src:I,className:"w-full h-full",title:"Contrato PDF"}):(0,r.jsx)(j,{message:"N\xe3o foi poss\xedvel carregar o documento.",onRetry:U})}),(0,r.jsxs)(b.xo,{children:[(0,r.jsx)(b.le,{disabled:u,children:"Voltar"}),(0,r.jsx)(b.OL,{onClick:L,disabled:u||!I,className:"bg-green-600 hover:bg-green-700",children:u?(0,r.jsx)(l.Z,{className:"h-4 w-4 animate-spin"}):"Confirmar Assinatura"})]})]})]}),B&&(0,r.jsxs)(o.z,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",onClick:_,disabled:E,children:[E?(0,r.jsx)(l.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Iniciar Atendimento"]})]})]})}},37099:function(e,t,a){a.d(t,{OL:function(){return g},_T:function(){return m},aR:function(){return d},f$:function(){return x},fY:function(){return f},le:function(){return N},vW:function(){return l},xo:function(){return h},yT:function(){return p}});var r=a(57437),s=a(2265),o=a(90277),n=a(94508),i=a(62869);let d=o.fC,l=o.xz,c=o.h_,u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.aV,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t})});u.displayName=o.aV.displayName;let m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(o.VY,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]})});m.displayName=o.VY.displayName;let f=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};f.displayName="AlertDialogHeader";let h=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};h.displayName="AlertDialogFooter";let x=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.Dx,{ref:t,className:(0,n.cn)("text-lg font-semibold",a),...s})});x.displayName=o.Dx.displayName;let p=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.dk,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})});p.displayName=o.dk.displayName;let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.aU,{ref:t,className:(0,n.cn)((0,i.d)(),a),...s})});g.displayName=o.aU.displayName;let N=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.$j,{ref:t,className:(0,n.cn)((0,i.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...s})});N.displayName=o.$j.displayName},87598:function(e,t,a){a.d(t,{LL:function(){return u},Sv:function(){return h},X3:function(){return d},c9:function(){return m},iD:function(){return l},kb:function(){return f},vO:function(){return c},yj:function(){return i}});var r=a(5978),s=a(13491),o=a(738),n=a(17293);let i=async e=>{let t=(0,o.Mq)(),a=(0,s.$C)(t,"us-central1"),r=(0,s.V1)(a,"createTelemedicineRoom");try{console.log("Chamando a Cloud Function 'createTelemedicineRoom' para o contrato: ".concat(e));let t=(await r({contractId:e})).data;if(t.success&&t.roomUrl)return console.log("Sala de telemedicina criada com sucesso:",t.roomUrl),t.roomUrl;throw Error("A Cloud Function n\xe3o retornou uma URL v\xe1lida.")}catch(e){throw console.error("Erro ao chamar a fun\xe7\xe3o createTelemedicineRoom:",e),Error("N\xe3o foi poss\xedvel criar a sala de telemedicina.")}},d=async e=>{let t=(0,o.Mq)(),a=(0,s.$C)(t,"us-central1"),r=(0,s.V1)(a,"generateContractPdf");try{let t=(await r({contractId:e})).data;if(t.success&&t.pdfUrl)return t.pdfUrl;throw Error("A Cloud Function n\xe3o retornou uma URL de PDF v\xe1lida.")}catch(e){throw console.error("Erro ao chamar a fun\xe7\xe3o generateContractPdf:",e),Error("N\xe3o foi poss\xedvel gerar o documento do contrato.")}},l=async e=>{let t=(0,r.JU)(n.db,"contracts",e);try{let e=await (0,r.QT)(t);if(e.exists())return{id:e.id,...e.data()};return null}catch(t){throw console.error("[getContractById] Erro ao buscar contrato ".concat(e,":"),t),Error("Falha ao carregar os detalhes do contrato.")}},c=async e=>{let t=n.I8.currentUser;if(!t||!e||0===e.length)return[];try{let a=(0,r.hJ)(n.db,"contracts"),s=(0,r.IO)(a,(0,r.ar)("doctorId","==",t.uid),(0,r.ar)("status","in",e),(0,r.Xo)("createdAt","desc"));return(await (0,r.PL)(s)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("[getContractsForDoctor] Erro:",e),Error("Falha ao carregar os contratos do m\xe9dico.")}},u=async e=>{let t=n.I8.currentUser;if(!t||!e||0===e.length)return[];try{let a=(0,r.hJ)(n.db,"contracts"),s=(0,r.IO)(a,(0,r.ar)("hospitalId","==",t.uid),(0,r.ar)("status","in",e),(0,r.Xo)("createdAt","desc"));return(await (0,r.PL)(s)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("[getContractsForHospital] Erro:",e),Error("Falha ao carregar os contratos do hospital.")}},m=async e=>{if(!n.I8.currentUser)throw Error("Usu\xe1rio n\xe3o autenticado.");let t=(0,r.JU)(n.db,"contracts",e);await (0,r.i3)(n.db,async a=>{var s;let o=await a.get(t);if(!o.exists()||"PENDING_DOCTOR_SIGNATURE"!==o.data().status)throw Error("Este contrato n\xe3o est\xe1 mais dispon\xedvel para assinatura.");let i=o.data().timeSlotId;if(!i)throw Error("ID da disponibilidade original n\xe3o encontrado no contrato.");let d=(0,r.JU)(n.db,"doctorTimeSlots",i),l=await a.get(d);if(l.exists()&&(null===(s=l.data())||void 0===s?void 0:s.status)!=="AVAILABLE")throw Error("Esta disponibilidade n\xe3o est\xe1 mais livre. A vaga pode ter sido preenchida.");a.update(t,{status:"PENDING_HOSPITAL_SIGNATURE",doctorSignature:{signedAt:(0,r.Bt)()},updatedAt:(0,r.Bt)()}),a.update(d,{status:"BOOKED",relatedContractId:e,updatedAt:(0,r.Bt)()})})},f=async e=>{let t=n.I8.currentUser;if(!t)throw Error("Hospital n\xe3o autenticado.");await (0,r.i3)(n.db,async a=>{let s=(0,r.JU)(n.db,"contracts",e),o=await a.get(s);if(!o.exists()||"PENDING_HOSPITAL_SIGNATURE"!==o.data().status)throw Error("Este contrato n\xe3o est\xe1 mais aguardando sua assinatura.");let i=o.data(),d=(0,r.JU)(n.db,"shiftRequirements",i.shiftRequirementId),l=(0,r.JU)(n.db,"users",i.doctorId),c=await a.get(l);if(a.update(s,{status:"ACTIVE_SIGNED",hospitalSignature:{signedAt:(0,r.Bt)(),signedByUID:t.uid},updatedAt:(0,r.Bt)()}),a.update(d,{status:"CONFIRMED",updatedAt:(0,r.Bt)()}),c.exists()){let e=c.data(),s=(0,r.JU)((0,r.hJ)(n.db,"users",t.uid,"hospitalDoctors"),i.doctorId);a.set(s,{name:e.displayName||"Nome n\xe3o informado",crm:e.professionalCrm||"N\xe3o informado",email:e.email||"N\xe3o informado",phone:e.phone||"N\xe3o informado",specialties:e.specialties||[],status:"ACTIVE_PLATFORM",source:"PLATFORM",addedAt:(0,r.Bt)()},{merge:!0})}})},h=async(e,t)=>{if(!e)throw Error("ID do contrato \xe9 obrigat\xf3rio.");if(!t||""===t.trim())throw Error("O motivo do cancelamento \xe9 obrigat\xf3rio.");let a=(0,r.JU)(n.db,"contracts",e);await (0,r.r7)(a,{status:"CANCELLED",cancellationReason:t,updatedAt:(0,r.Bt)()})}}}]);