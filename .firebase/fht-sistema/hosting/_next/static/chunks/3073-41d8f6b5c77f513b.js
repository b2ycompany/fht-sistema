"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3073],{46413:function(r,e,t){t.d(e,{AuthProvider:function(){return l},a:function(){return f}});var a=t(57437),o=t(2265),n=t(82148),i=t(17293),s=t(92651),c=t(99376);let u=r=>{if(!r||!r.userType)return"/login";switch(r.userType){case"admin":case"backoffice":return"/admin/caravanas";case"hospital":return"/hospital/dashboard";case"doctor":return"/dashboard";case"receptionist":return"/dashboard/reception";case"triage_nurse":return"/dashboard/triage";case"caravan_admin":if(r.assignedCaravanId)return"/caravan/".concat(r.assignedCaravanId,"/dashboard");return"/";default:return"/"}},d=(0,o.createContext)(void 0),l=r=>{let{children:e}=r,[t,l]=(0,o.useState)(null),[f,h]=(0,o.useState)(null),[p,v]=(0,o.useState)(!0),[w,m]=(0,o.useState)(!0),[y,A]=(0,o.useState)(!1),g=(0,c.useRouter)(),I=(0,c.usePathname)();return(0,o.useEffect)(()=>{let r=(0,n.Aj)(i.I8,async r=>{if(v(!0),m(!0),l(r),r)try{let e=(await r.getIdTokenResult()).claims.role,t=["/login","/register","/reset-password"].some(r=>I.startsWith(r));if(!e&&!t&&!y){console.warn("[AuthProvider] Usu\xe1rio ".concat(r.uid," autenticado mas sem role v\xe1lida. For\xe7ando logout para seguran\xe7a. Pathname: ").concat(I)),await (0,n.w7)(i.I8),h(null),m(!1),v(!1);return}if(e){console.log("[AuthProvider] Role v\xe1lida encontrada. Carregando perfil do usu\xe1rio...");let r=await (0,s.Ts)();if(r&&"INVITED"===r.status){await (0,s.DD)();let e={...r,status:"ACTIVE"};h(e)}else h(r);let e=u(r);t&&g.replace(e)}else(t||y)&&console.log("[AuthProvider] Usu\xe1rio ".concat(r.uid," sem role, mas fluxo de registro/p\xfablico permitido. Pathname: ").concat(I))}catch(r){console.error("[AuthProvider] Erro cr\xedtico no fluxo de autentica\xe7\xe3o:",r),await (0,n.w7)(i.I8)}finally{m(!1)}else h(null),m(!1);v(!1)});return()=>r()},[g,I,y]),(0,a.jsx)(d.Provider,{value:{user:t,userProfile:f,loading:p,profileLoading:w,isRegistering:y,setIsRegistering:A},children:e})},f=()=>{let r=(0,o.useContext)(d);if(void 0===r)throw Error("useAuth must be used within an AuthProvider");return r}},92651:function(r,e,t){t.d(e,{CQ:function(){return d},DD:function(){return c},Fl:function(){return m},TX:function(){return f},Ts:function(){return p},bI:function(){return w},c0:function(){return h},et:function(){return v},ey:function(){return A},hc:function(){return y},pH:function(){return l},q9:function(){return u}});var a=t(82148),o=t(5978),n=t(17293),i=t(1850);(0,i.V1)(n.wk,"createStaffUser");let s=(0,i.V1)(n.wk,"confirmUserSetup"),c=async()=>{try{await s()}catch(r){console.warn("Falha ao tentar confirmar o primeiro login:",r)}},u=async(r,e,t)=>{try{let o=await (0,a.Xb)(n.I8,r,e);return await (0,a.ck)(o.user,{displayName:t}),o.user}catch(r){throw console.error("[AuthService] Erro ao criar usu\xe1rio no Auth:",r),r}},d=async function(r,e,t,a,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=(0,o.JU)(n.db,"users",r);try{if(s)await (0,o.r7)(c,{...i,updatedAt:(0,o.Bt)()}),console.log("[AuthService] Perfil para ".concat(r," ATUALIZADO com SUCESSO no Firestore."));else{let n={};if("doctor"===a){let{documents:r,specialistDocuments:e,invitationToken:t,...a}=i;n={...a,documents:r,specialistDocuments:e,invitationToken:t||null}}else if("hospital"===a){let{hospitalDocs:r,legalRepDocuments:e,...t}=i;n={companyInfo:{cnpj:t.cnpj,stateRegistration:t.stateRegistration,phone:t.phone,address:t.address},legalRepresentativeInfo:t.legalRepresentativeInfo,hospitalDocs:r,legalRepDocuments:e}}else if(["receptionist","triage_nurse","caravan_admin","admin","backoffice"].includes(a))n={};else throw Error("Tipo de perfil de registro inv\xe1lido.");let s={uid:r,email:e,displayName:t,userType:a,createdAt:(0,o.Bt)(),updatedAt:(0,o.Bt)(),documentVerificationStatus:"PENDING_REVIEW",adminVerificationNotes:"",...n};await (0,o.pl)(c,s),console.log("[AuthService] Perfil para ".concat(r," criado com SUCESSO no Firestore."))}}catch(e){throw console.error("[AuthService] ERRO CR\xcdTICO ao tentar processar o perfil no Firestore para o user ".concat(r,":"),e),e}},l=async(r,e)=>{try{return(await (0,a.e5)(n.I8,r,e)).user}catch(r){throw console.error("[AuthService] Login error:",r),r}},f=async()=>{try{await (0,a.w7)(n.I8)}catch(r){throw console.error("[AuthService] Logout error:",r),r}},h=async r=>{try{await (0,a.LS)(n.I8,r)}catch(r){throw console.error("[AuthService] Reset error:",r),r}},p=async()=>{let r=n.I8.currentUser;if(!r)return null;try{let e=(0,o.JU)(n.db,"users",r.uid),t=await (0,o.QT)(e);if(t.exists())return{uid:t.id,...t.data()};return null}catch(r){throw console.error("[AuthService] Get current user data error:",r),r}},v=async r=>{if(!r)return null;try{let e=(0,o.JU)(n.db,"users",r),t=await (0,o.QT)(e);if(t.exists())return{uid:t.id,...t.data()};return console.warn("[AuthService] Nenhum perfil encontrado para o ID: ".concat(r)),null}catch(e){throw console.error("[AuthService] Erro ao buscar perfil para o ID ".concat(r,":"),e),Error("N\xe3o foi poss\xedvel buscar o perfil do utilizador.")}},w=async(r,e)=>{if(!r)throw Error("ID do Doutor n\xe3o fornecido para atualiza\xe7\xe3o.");if(!e||0===Object.keys(e).length){console.warn("[AuthService] Nenhum dado fornecido para atualiza\xe7\xe3o do perfil do doutor.");return}let t=(0,o.JU)(n.db,"users",r),a={};if(Object.keys(e).forEach(r=>{void 0!==e[r]&&("address"===r&&"object"==typeof e.address&&null!==e.address?Object.keys(e.address).forEach(r=>{void 0!==e.address[r]&&(a["address.".concat(r)]=e.address[r])}):a[r]=e[r])}),0===Object.keys(a).length){console.warn("[AuthService] Nenhum dado v\xe1lido para atualizar ap\xf3s filtrar undefined.");return}a.updatedAt=(0,o.Bt)();try{var i;let e=await (0,o.QT)(t);if(!e.exists()||(null===(i=e.data())||void 0===i?void 0:i.userType)!=="doctor")throw Error("Perfil de doutor n\xe3o encontrado ou tipo de usu\xe1rio incorreto para atualiza\xe7\xe3o.");await (0,o.r7)(t,a),console.log("[AuthService] Perfil do doutor ".concat(r," atualizado com sucesso."))}catch(e){throw console.error("[AuthService] Erro ao atualizar perfil do doutor ".concat(r,":"),e),e}},m=async(r,e)=>{try{let t=(0,o.hJ)(n.db,"users"),a=(0,o.IO)(t,(0,o.ar)("userType","==","doctor"),(0,o.ar)("specialties","array-contains",e),(0,o.ar)("healthUnitIds","array-contains",r)),i=await (0,o.PL)(a);if(i.empty)return[];return i.docs.map(r=>({uid:r.id,...r.data()}))}catch(r){throw console.error("[AuthService] Erro ao buscar m\xe9dicos associados por especialidade:",r),Error("N\xe3o foi poss\xedvel carregar a lista de m\xe9dicos para esta unidade.")}},y=async function(r,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!r)throw Error("ID do usu\xe1rio n\xe3o fornecido.");let i=(0,o.JU)(n.db,"users",r),s={documentVerificationStatus:e,adminVerificationNotes:t,documentRejectionReasons:a,updatedAt:(0,o.Bt)()};"APPROVED"===e&&(s.documentRejectionReasons={},s.adminVerificationNotes="");try{await (0,o.r7)(i,s)}catch(e){throw console.error("Erro ao atualizar status do usu\xe1rio ".concat(r,":"),e),Error("Falha ao atualizar o status do cadastro.")}},A=async r=>{if(!r)return[];try{let e=(0,o.hJ)(n.db,"users"),t=(0,o.IO)(e,(0,o.ar)("userType","==","doctor"),(0,o.ar)("healthUnitIds","array-contains",r)),a=await (0,o.PL)(t);if(a.empty)return[];return a.docs.map(r=>({uid:r.id,...r.data()}))}catch(e){throw console.error("[AuthService] Erro ao buscar m\xe9dicos associados para o hospital ".concat(r,":"),e),Error("N\xe3o foi poss\xedvel carregar a lista de m\xe9dicos associados.")}}},17293:function(r,e,t){t.d(e,{I8:function(){return u},db:function(){return d},tO:function(){return l},wk:function(){return f}});var a=t(738),o=t(82148),n=t(5978),i=t(96485),s=t(1850);let c=(0,a.C6)().length?(0,a.Mq)():(0,a.ZF)({apiKey:"AIzaSyAyoX1YqAdqHuIvSoj0Yw_FYnhCBv-KfEA",authDomain:"fht-sistema.firebaseapp.com",projectId:"fht-sistema",storageBucket:"fht-sistema.firebasestorage.app",messagingSenderId:"583837273524",appId:"1:583837273524:web:1583addfce581e61ac76e1",measurementId:"G-6FJ2H3G32N"}),u=(0,o.v0)(c),d=(0,n.ad)(c),l=(0,i.cF)(c),f=(0,s.$C)(c,"us-central1")},94508:function(r,e,t){t.d(e,{bx:function(){return c},cn:function(){return n},rl:function(){return s},xG:function(){return i}});var a=t(61994),o=t(53335);function n(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++)e[t]=arguments[t];return(0,o.m6)((0,a.W)(e))}let i=r=>null==r||isNaN(r)?"R$ -":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r),s=r=>null==r||isNaN(r)?"- %":"".concat(r.toFixed(1),"%"),c=r=>null==r||isNaN(r)?"- h":"".concat(r.toFixed(1)," h")}}]);